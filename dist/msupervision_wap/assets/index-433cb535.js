import{c as W,d as E,u as ae,e as X,h as s,n as Y,t as R,aq as le,aV as te,w as H,aW as K,aX as ne,an as ie,I as z,aO as re,aU as Z,i as oe,aH as se,af as O,r as D,ay as ce,aY as ue,m as _,j as x,q as de,y as $,z as q,aZ as fe,aM as B,A as ve,ag as ge,o as me}from"./index-6bedc73c.js";import{I as we,s as he}from"./_plugin-vue_export-helper-524fd211.js";const[pe,be]=W("form"),ye={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:Y,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:R,showErrorMessage:R,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var Pe=E({name:pe,props:ye,emits:["submit","failed"],setup(e,{emit:n,slots:c}){const{children:o,linkChildren:w}=ae(te),h=l=>l?o.filter(r=>l.includes(r.name)):o,S=l=>new Promise((r,v)=>{const P=[];h(l).reduce((A,j)=>A.then(()=>{if(!P.length)return j.validate().then(C=>{C&&P.push(C)})}),Promise.resolve()).then(()=>{P.length?v(P):r()})}),y=l=>new Promise((r,v)=>{const P=h(l);Promise.all(P.map(b=>b.validate())).then(b=>{b=b.filter(Boolean),b.length?v(b):r()})}),I=l=>{const r=o.find(v=>v.name===l);return r?new Promise((v,P)=>{r.validate().then(b=>{b?P(b):v()})}):Promise.reject()},U=l=>typeof l=="string"?I(l):e.validateFirst?S(l):y(l),i=l=>{typeof l=="string"&&(l=[l]),h(l).forEach(v=>{v.resetValidation()})},g=()=>o.reduce((l,r)=>(l[r.name]=r.getValidationStatus(),l),{}),p=(l,r)=>{o.some(v=>v.name===l?(v.$el.scrollIntoView(r),!0):!1)},f=()=>o.reduce((l,r)=>(r.name!==void 0&&(l[r.name]=r.formValue.value),l),{}),k=()=>{const l=f();U().then(()=>n("submit",l)).catch(r=>{n("failed",{values:l,errors:r}),e.scrollToError&&r[0].name&&p(r[0].name)})},L=l=>{le(l),k()};return w({props:e}),X({submit:k,validate:U,getValues:f,scrollToField:p,resetValidation:i,getValidationStatus:g}),()=>{var l;return s("form",{class:be(),onSubmit:L},[(l=c.default)==null?void 0:l.call(c)])}}});const Be=H(Pe),[Ie,u,ke]=W("uploader");function G(e,n){return new Promise(c=>{if(n==="file"){c();return}const o=new FileReader;o.onload=w=>{c(w.target.result)},n==="dataUrl"?o.readAsDataURL(e):n==="text"&&o.readAsText(e)})}function J(e,n){return K(e).some(c=>c.file?ne(n)?n(c.file):c.file.size>+n:!1)}function Fe(e,n){const c=[],o=[];return e.forEach(w=>{J(w,n)?o.push(w):c.push(w)}),{valid:c,invalid:o}}const Se=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,Ue=e=>Se.test(e);function Q(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?Ue(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Ve=E({props:{name:Y,item:ie(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:n,slots:c}){const o=()=>{const{status:i,message:g}=e.item;if(i==="uploading"||i==="failed"){const p=i==="failed"?s(z,{name:"close",class:u("mask-icon")},null):s(re,{class:u("loading")},null),f=oe(g)&&g!=="";return s("div",{class:u("mask")},[p,f&&s("div",{class:u("mask-message")},[g])])}},w=i=>{const{name:g,item:p,index:f,beforeDelete:k}=e;i.stopPropagation(),se(k,{args:[p,{name:g,index:f}],done:()=>n("delete")})},h=()=>n("preview"),S=()=>n("reupload"),y=()=>{if(e.deletable&&e.item.status!=="uploading"){const i=c["preview-delete"];return s("div",{role:"button",class:u("preview-delete",{shadow:!i}),tabindex:0,"aria-label":ke("delete"),onClick:w},[i?i():s(z,{name:"cross",class:u("preview-delete-icon")},null)])}},I=()=>{if(c["preview-cover"]){const{index:i,item:g}=e;return s("div",{class:u("preview-cover")},[c["preview-cover"](O({index:i},g))])}},U=()=>{const{item:i,lazyLoad:g,imageFit:p,previewSize:f,reupload:k}=e;return Q(i)?s(we,{fit:p,src:i.objectUrl||i.content||i.url,class:u("preview-image"),width:Array.isArray(f)?f[0]:f,height:Array.isArray(f)?f[1]:f,lazyLoad:g,onClick:k?S:h},{default:I}):s("div",{class:u("file"),style:Z(e.previewSize)},[s(z,{class:u("file-icon"),name:"description"},null),s("div",{class:[u("file-name"),"van-ellipsis"]},[i.file?i.file.name:i.url]),I()])};return()=>s("div",{class:u("preview")},[U(),o(),y()])}});const Re={name:_(""),accept:x("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:_(1/0),imageFit:x("cover"),resultType:x("dataUrl"),uploadIcon:x("photograph"),uploadText:String,deletable:R,reupload:Boolean,afterRead:Function,showUpload:R,modelValue:de(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:R,previewOptions:Object,previewFullImage:R,maxSize:{type:[Number,String,Function],default:1/0}};var Ce=E({name:Ie,props:Re,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:n,slots:c}){const o=D(),w=[],h=D(-1),S=D(!1),y=(a=e.modelValue.length)=>({name:e.name,index:a}),I=()=>{o.value&&(o.value.value="")},U=a=>{if(I(),J(a,e.maxSize))if(Array.isArray(a)){const t=Fe(a,e.maxSize);if(a=t.valid,n("oversize",t.invalid,y()),!a.length)return}else{n("oversize",a,y());return}if(a=me(a),h.value>-1){const t=[...e.modelValue];t.splice(h.value,1,a),n("update:modelValue",t),h.value=-1}else n("update:modelValue",[...e.modelValue,...K(a)]);e.afterRead&&e.afterRead(a,y())},i=a=>{const{maxCount:t,modelValue:m,resultType:d}=e;if(Array.isArray(a)){const F=+t-m.length;a.length>F&&(a=a.slice(0,F)),Promise.all(a.map(V=>G(V,d))).then(V=>{const ee=a.map((T,M)=>{const N={file:T,status:"",message:"",objectUrl:URL.createObjectURL(T)};return V[M]&&(N.content=V[M]),N});U(ee)})}else G(a,d).then(F=>{const V={file:a,status:"",message:"",objectUrl:URL.createObjectURL(a)};F&&(V.content=F),U(V)})},g=a=>{const{files:t}=a.target;if(e.disabled||!t||!t.length)return;const m=t.length===1?t[0]:[].slice.call(t);if(e.beforeRead){const d=e.beforeRead(m,y());if(!d){I();return}if(fe(d)){d.then(F=>{i(F||m)}).catch(I);return}}i(m)};let p;const f=()=>n("closePreview"),k=a=>{if(e.previewFullImage){const t=e.modelValue.filter(Q),m=t.map(d=>(d.objectUrl&&!d.url&&d.status!=="failed"&&(d.url=d.objectUrl,w.push(d.url)),d.url)).filter(Boolean);p=he(O({images:m,startPosition:t.indexOf(a),onClose:f},e.previewOptions))}},L=()=>{p&&p.close()},l=(a,t)=>{const m=e.modelValue.slice(0);m.splice(t,1),n("update:modelValue",m),n("delete",a,y(t))},r=a=>{S.value=!0,h.value=a,ge(()=>C())},v=()=>{S.value||(h.value=-1),S.value=!1},P=(a,t)=>{const m=["imageFit","deletable","reupload","previewSize","beforeDelete"],d=O(B(e,m),B(a,m,!0));return s(Ve,ve({item:a,index:t,onClick:()=>n(e.reupload?"clickReupload":"clickPreview",a,y(t)),onDelete:()=>l(a,t),onPreview:()=>k(a),onReupload:()=>r(t)},B(e,["name","lazyLoad"]),d),B(c,["preview-cover","preview-delete"]))},b=()=>{if(e.previewImage)return e.modelValue.map(P)},A=a=>n("clickUpload",a),j=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const a=e.modelValue.length>=+e.maxCount&&e.reupload,t=e.readonly?null:s("input",{ref:o,type:"file",class:u("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&h.value===-1,disabled:e.disabled,onChange:g,onClick:v},null);return c.default?$(s("div",{class:u("input-wrapper"),onClick:A},[c.default(),t]),[[q,!a]]):$(s("div",{class:u("upload",{readonly:e.readonly}),style:Z(e.previewSize),onClick:A},[s(z,{name:e.uploadIcon,class:u("upload-icon")},null),e.uploadText&&s("span",{class:u("upload-text")},[e.uploadText]),t]),[[q,e.showUpload&&!a]])},C=()=>{o.value&&!e.disabled&&o.value.click()};return ce(()=>{w.forEach(a=>URL.revokeObjectURL(a))}),X({chooseFile:C,closeImagePreview:L}),ue(()=>e.modelValue),()=>s("div",{class:u()},[s("div",{class:u("wrapper",{disabled:e.disabled})},[b(),j()])])}});const ze=H(Ce);export{Be as F,ze as U};
