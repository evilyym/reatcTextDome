import{h as $,ad as E,R as J,a as b,F as P,aM as j,ae as T,al as p,ao as d,ap as i,ar as c,aq as _,Z as L,z as o,af as n,$ as M,a9 as X,ak as s,am as K,an as Q,ag as q,as as Z,at as G,aN as H,aO as W,aP as Y,aK as z,aa as ee,aQ as ae}from"./index-743c3a8c.js";import{F as le,b as te,U as ue,B as oe,a as re}from"./index-ec1a7bca.js";import{_ as ne}from"./_plugin-vue_export-helper-b52e6afd.js";const B=U=>(Z("data-v-c3a4e1ea"),U=U(),G(),U),se={class:"eventDetails"},de={class:"userInfo"},ie={class:"activityInfo"},pe=B(()=>p("h4",null,"活动信息",-1)),me=B(()=>p("h5",null,"申请材料",-1)),ve={class:"materialsBox"},_e=B(()=>p("h5",null,"使用信息",-1)),ce=["download","href"],ye=["download","href"],fe={style:{margin:"16px"},class:"btnBox"},ge=$({__name:"index",setup(U){const y=E(),h=y.currentRoute.value.query.userType||J("$active"),V=b(!1),F=async()=>{let t,a;switch(v.value.status){case 2:case 3:a={...m.value,id:y.currentRoute.value.query.id,status:v.value.status},t=await W(a);break;case 4:const r=b([]);m.value.report_image&&m.value.report_image.forEach(u=>{r.value.push(u.url)}),a={...m.value,id:y.currentRoute.value.query.id,report_image:r.value,file:f.value},t=await H(a);break}V.value=!1,t.code==200&&setTimeout(()=>{y.go(y.currentRoute.value.query.userType?0:-1)},500)},I=async()=>{const t={id:y.currentRoute.value.query.id};(await Y(t)).code==200&&setTimeout(()=>{y.go(y.currentRoute.value.query.userType?0:-1)},500)},N=()=>{re({message:"确定要撤销申请?"}).then(()=>{A()}).catch(()=>{})},f=b([]),A=async()=>{const t={id:y.currentRoute.value.query.id};(await ae(t)).code==200&&setTimeout(()=>{y.go(-1)},300)},v=b({label:"",status:null,placeholder:"",height:"40%"}),m=b({report_image:[]}),C=t=>{switch(V.value=!0,t){case 1:V.value=!1,N();break;case 2:v.value={label:"同意",status:t,placeholder:"同意理由:",height:"40%"};break;case 3:v.value={label:"驳回",status:t,placeholder:"驳回理由:",height:"40%"};break;case 4:v.value={label:"报备",status:t,placeholder:"",height:"70%"};break}},e=b({activity:{},file:[]}),R=async t=>{if(t instanceof Array)for(let a=0;a<t.length;a++){let r=t[a].file,u=new FormData;u.append("file",r,r.name),u.append("type","2");const k=await z(u);m.value.report_image[a].url=k.data.url}else{let a=t.file,r=new FormData;if(r.append("file",a,a.name),/image/.test(a.type)){r.append("type","2");const u=await z(r);m.value.report_image[m.value.report_image.length-1].url=u.data.url}else{r.append("type","1");const u=await z(r);f.value[f.value.length-1].url=u.data.url,f.value[f.value.length-1].name=a.name,f.value[f.value.length-1].file_tpye=a.type,delete f.value[f.value.length-1].objectUrl}}},D=t=>{switch(t){case 1:return"待审核";case 2:return"审核通过";case 3:return"审核驳回"}};return P(async()=>{const t=(await j({id:y.currentRoute.value.query.id})).data;t.file=t.file&&Array.isArray(JSON.parse(t.file))?JSON.parse(t.file):[],t.report_file=t.report_file&&Array.isArray(JSON.parse(t.report_file))?JSON.parse(t.report_file):[],e.value=t,e.value.attachment?e.value.attachment.forEach((a,r)=>{e.value.attachment[r]={url:a}}):e.value.attachment=[],e.value.report_image?e.value.report_image.forEach((a,r)=>{a&&(e.value.report_image[r]={url:a})}):e.value.report_image=[]}),(t,a)=>{const r=ee,u=te,k=le,S=ue,g=oe,O=X;return s(),T("div",se,[p("div",{class:L(["activityState",{back_blue:e.value.audit_status==1,back_green:e.value.audit_status==2,back_red:e.value.audit_status==3}])},[e.value.audit_status==1?(s(),d(r,{key:0,name:"clock"})):i("",!0),e.value.audit_status==3?(s(),d(r,{key:1,name:"clear"})):i("",!0),e.value.audit_status==2?(s(),d(r,{key:2,name:"checked"})):i("",!0),c(" "+_(D(e.value.audit_status))+_(e.value.report_status==2?"，已确认":"")+" ",1),p("p",null,_(e.value.reason),1)],2),p("div",de,[p("p",null,[p("span",null,[o(r,{name:"user"}),c(_(e.value.name),1)]),c(),p("span",null,[o(r,{name:"phone"}),c(_(e.value.phone),1)])]),p("p",null,[o(r,{name:"friends"}),c(" "+_(e.value.department),1)])]),p("div",ie,[pe,o(k,{"input-align":"right"},{default:n(()=>[o(u,{modelValue:e.value.activity_name,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.activity_name=l),name:"",label:"服务内容:",readonly:"",placeholder:"服务内容"},null,8,["modelValue"]),o(u,{modelValue:e.value.leader_name,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.leader_name=l),name:"",label:"负责人:",placeholder:"负责人",readonly:""},null,8,["modelValue"]),o(u,{modelValue:e.value.leader_phone,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.leader_phone=l),name:"",label:"手机号:",placeholder:"手机号",readonly:""},null,8,["modelValue"])]),_:1}),o(k,{"label-align":"top"},{default:n(()=>[me,o(u,{readonly:""},{input:n(()=>[p("div",ve,[(s(!0),T(K,null,Q(e.value.materials,l=>(s(),T("div",null,_(l.name)+" "+_(l.number)+" "+_(l.unit),1))),256))])]),_:1}),_e,o(u,{readonly:"",modelValue:e.value.usage_location,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.usage_location=l),name:"",label:"地点:",placeholder:"请输入地点",rules:[{required:!0,message:"请输入地点"}]},null,8,["modelValue"]),o(u,{readonly:"",label:"时间:",placeholder:"请选择使用时间",rules:[{required:!0,message:"请选择使用时间"}]},{input:n(()=>[c(_(e.value.usage_start_time)+" 至 "+_(e.value.usage_end_time),1)]),_:1}),o(u,{readonly:"",autosize:"",type:"textarea",rows:"2",maxlength:"100",modelValue:e.value.usage_reason,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.usage_reason=l),name:"",label:"原因:",placeholder:"请输入使用原因",rules:[{required:!0,message:"请输入使用原因"}]},null,8,["modelValue"]),o(u,{readonly:"",name:"uploader",label:"上传图片:"},{input:n(()=>[o(S,{readonly:"",deletable:!1,modelValue:e.value.attachment,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.attachment=l),"after-read":R,multiple:"","max-count":3},null,8,["modelValue"])]),_:1}),o(u,{readonly:"",name:"uploader",label:"上传文件:"},{input:n(()=>{var l,w,x;return[p("a",{download:(l=e.value.file[0])==null?void 0:l.name,href:(w=e.value.file[0])==null?void 0:w.url},_((x=e.value.file[0])==null?void 0:x.name),9,ce)]}),_:1}),o(u,{readonly:"",modelValue:e.value.remark,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.remark=l),autosize:"",type:"textarea",maxlength:"144",label:"备注:",placeholder:"备注"},null,8,["modelValue"]),e.value.audit_status==2&&e.value.report_reason?(s(),d(u,{key:0,readonly:"",modelValue:e.value.report_reason,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.report_reason=l),label:"报备理由:",autosize:"",type:"textarea"},null,8,["modelValue"])):i("",!0),e.value.audit_status==2&&e.value.report_reason?(s(),d(u,{key:1,readonly:"",modelValue:e.value.report_amount,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.report_amount=l),label:"活动金额:"},null,8,["modelValue"])):i("",!0),e.value.audit_status==2&&e.value.report_reason?(s(),d(u,{key:2,readonly:"",name:"uploader",label:"报备图片:"},{input:n(()=>[o(S,{readonly:"",deletable:!1,modelValue:e.value.report_image,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.report_image=l),"after-read":R,multiple:"","max-count":3},null,8,["modelValue"])]),_:1})):i("",!0),e.value.audit_status==2&&e.value.report_reason?(s(),d(u,{key:3,readonly:"",name:"uploader",label:"报备文件:"},{input:n(()=>{var l,w,x;return[p("a",{download:(l=e.value.report_file[0])==null?void 0:l.name,href:(w=e.value.report_file[0])==null?void 0:w.url},_((x=e.value.report_file[0])==null?void 0:x.name),9,ye)]}),_:1})):i("",!0),p("div",fe,[q(h)==2&&e.value.audit_status==1?(s(),d(g,{key:0,type:"primary",onClick:a[10]||(a[10]=l=>C(1)),round:"",block:""},{default:n(()=>[c("撤销")]),_:1})):i("",!0),q(h)==1&&e.value.audit_status==1?(s(),d(g,{key:1,type:"primary",onClick:a[11]||(a[11]=l=>C(2)),round:"",block:""},{default:n(()=>[c("通过")]),_:1})):i("",!0),q(h)==1&&e.value.audit_status==1?(s(),d(g,{key:2,type:"primary",onClick:a[12]||(a[12]=l=>C(3)),round:"",block:""},{default:n(()=>[c("驳回")]),_:1})):i("",!0),q(h)==1&&e.value.audit_status==2&&e.value.reporter_phone&&!e.value.report_reason?(s(),d(g,{key:3,type:"primary",onClick:a[13]||(a[13]=l=>C(4)),round:"",block:""},{default:n(()=>[c("报备")]),_:1})):i("",!0),q(h)==2&&e.value.audit_status==2&&e.value.report_status==1&&e.value.report_reason?(s(),d(g,{key:4,type:"primary",onClick:I,round:"",block:""},{default:n(()=>[c("确认")]),_:1})):i("",!0)])]),_:1})]),o(O,{show:V.value,"onUpdate:show":a[19]||(a[19]=l=>V.value=l),round:"",position:"bottom",class:"dialog",closeable:"",style:M({height:v.value.height})},{default:n(()=>[p("h4",null,_(v.value.label),1),o(k,{"label-align":"top",onSubmit:F},{default:n(()=>[v.value.status!=4?(s(),d(u,{key:0,required:"",modelValue:m.value.reason,"onUpdate:modelValue":a[14]||(a[14]=l=>m.value.reason=l),autosize:"",type:"textarea",rows:"3",maxlength:"144","show-word-limit":"",label:v.value.placeholder,placeholder:v.value.placeholder,rules:[{required:!0,message:"理由必须输入"}]},null,8,["modelValue","label","placeholder"])):i("",!0),v.value.status==4?(s(),d(u,{key:1,required:"",modelValue:m.value.report_reason,"onUpdate:modelValue":a[15]||(a[15]=l=>m.value.report_reason=l),autosize:"",type:"textarea",rows:"3",maxlength:"144","show-word-limit":"",label:"报备理由:",placeholder:"请输入报备理由",rules:[{required:!0,message:"请输入报备理由"}]},null,8,["modelValue"])):i("",!0),v.value.status==4?(s(),d(u,{key:2,required:"",modelValue:m.value.report_amount,"onUpdate:modelValue":a[16]||(a[16]=l=>m.value.report_amount=l),type:"number","show-word-limit":"",label:"报备金额:",placeholder:"请输入报备金额",rules:[{required:!0,message:"请输入报备金额"}]},null,8,["modelValue"])):i("",!0),v.value.status==4?(s(),d(u,{key:3,name:"uploader",label:"上传图片:",rules:[{message:"必须上传图片"}]},{input:n(()=>[o(S,{modelValue:m.value.report_image,"onUpdate:modelValue":a[17]||(a[17]=l=>m.value.report_image=l),"after-read":R,multiple:"","max-count":3},null,8,["modelValue"])]),_:1})):i("",!0),v.value.status==4?(s(),d(u,{key:4,name:"uploader",label:"报备附件:",rules:[{message:"只能上传PDF,TXT,XLS,DOC文件"}]},{input:n(()=>[o(S,{"max-count":1,modelValue:f.value,"onUpdate:modelValue":a[18]||(a[18]=l=>f.value=l),"after-read":R,accept:"text/plain, application/vnd.ms-excel, application/vnd.ms-works, application/msword, application/pdf"},{default:n(()=>[o(g,{icon:"plus",size:"small",type:"primary"},{default:n(()=>[c("报备附件")]),_:1})]),_:1},8,["modelValue"])]),_:1})):i("",!0),o(g,{type:"primary",round:"",block:"","native-type":"submit"},{default:n(()=>[c("确定")]),_:1})]),_:1})]),_:1},8,["show","style"])])}}});const ke=ne(ge,[["__scopeId","data-v-c3a4e1ea"]]);export{ke as default};
