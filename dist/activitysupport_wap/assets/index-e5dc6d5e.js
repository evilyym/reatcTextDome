import{h as O,ad as P,R as L,a as h,F as M,aM as X,ae as D,al as m,ao as i,ap as p,ar as y,aq as _,Z as K,z as r,af as s,$ as Q,a9 as Z,ak as d,am as G,an as H,ag as q,as as J,at as W,aN as Y,aO as ee,aP as ae,au as le,aK as F,aa as te,aQ as ue}from"./index-7887ff55.js";import{F as oe,b as re,U as ne,B as se,a as de}from"./index-5ed5df12.js";import{_ as ie}from"./_plugin-vue_export-helper-70877c7d.js";const z=U=>(J("data-v-3936c343"),U=U(),W(),U),pe={class:"eventDetails"},me={class:"userInfo"},ve={class:"activityInfo"},ce=z(()=>m("h4",null,"活动信息",-1)),_e=z(()=>m("h5",null,"申请材料",-1)),ye={class:"materialsBox"},fe=z(()=>m("h5",null,"使用信息",-1)),ge=["download","href"],be=["download","href"],he={style:{margin:"16px"},class:"btnBox"},Ve=O({__name:"index",setup(U){const f=P(),V=f.currentRoute.value.query.userType||L("$active"),k=h(!1),B=async()=>{let t,e;switch(c.value.status){case 2:case 3:e={...v.value,id:f.currentRoute.value.query.id,status:c.value.status},t=await ee(e);break;case 4:const o=h([]);v.value.report_image&&v.value.report_image.forEach(u=>{o.value.push(u.url)}),e={...v.value,id:f.currentRoute.value.query.id,report_image:o.value,file:n.value.length>0?n.value[0]:null},t=await Y(e);break}k.value=!1,t.code==200&&setTimeout(()=>{f.go(f.currentRoute.value.query.userType?0:-1)},500)},I=async()=>{const t={id:f.currentRoute.value.query.id};(await ae(t)).code==200&&setTimeout(()=>{f.go(f.currentRoute.value.query.userType?0:-1)},500)},S=()=>{de({message:"确定要撤销申请?"}).then(()=>{$()}).catch(()=>{})},n=h([]),$=async()=>{const t={id:f.currentRoute.value.query.id};(await ue(t)).code==200&&setTimeout(()=>{f.go(-1)},300)},c=h({label:"",status:null,placeholder:"",height:"40%"}),v=h({report_image:[]}),C=t=>{switch(k.value=!0,t){case 1:k.value=!1,S();break;case 2:c.value={label:"同意",status:t,placeholder:"同意理由:",height:"40%"};break;case 3:c.value={label:"驳回",status:t,placeholder:"驳回理由:",height:"40%"};break;case 4:c.value={label:"报备",status:t,placeholder:"",height:"70%"};break}},a=h({activity:{},file:[]}),A=t=>{const e=["pdf","docx","doc","txt","xlsx","xls"];return e.indexOf(t.name.split(".").reverse()[0])==-1?(le("只能上传"+e.join()+"文件"),!1):!0},T=async t=>{if(t instanceof Array)for(let e=0;e<t.length;e++){let o=t[e].file,u=new FormData;u.append("file",o,o.name),u.append("type","2");const g=await F(u);v.value.report_image[e].url=g.data.url}else{let e=t.file,o=new FormData;o.append("file",e,e.name),o.append("type","2");const u=await F(o);v.value.report_image[v.value.report_image.length-1].url=u.data.url}},N=async t=>{if(t instanceof Array)for(let e=0;e<t.length;e++){let o=t[e].file,u=new FormData;u.append("file",o,o.name),u.append("type","1");const g=await F(u);n.value[n.value.length-1].url=g.data.url,n.value[n.value.length-1].name=o.name,n.value[n.value.length-1].file_tpye=o.type,delete n.value[n.value.length-1].objectUrl}else{let e=t.file,o=new FormData;o.append("file",e,e.name),o.append("type","1");const u=await F(o);n.value[n.value.length-1].url=u.data.url,n.value[n.value.length-1].name=e.name,n.value[n.value.length-1].file_tpye=e.type,delete n.value[n.value.length-1].objectUrl}},j=t=>{switch(t){case 1:return"待审核";case 2:return"审核通过";case 3:return"审核驳回"}};return M(async()=>{const t=(await X({id:f.currentRoute.value.query.id})).data;t.file=t.file?[t.file]:[],t.report_file=t.report_file?[t.report_file]:[],a.value=t,a.value.attachment?a.value.attachment.forEach((e,o)=>{a.value.attachment[o]={url:e}}):a.value.attachment=[],a.value.report_image?a.value.report_image.forEach((e,o)=>{e&&(a.value.report_image[o]={url:e})}):a.value.report_image=[]}),(t,e)=>{const o=te,u=re,g=oe,R=ne,b=se,E=Z;return d(),D("div",pe,[m("div",{class:K(["activityState",{back_blue:a.value.audit_status==1,back_green:a.value.audit_status==2,back_red:a.value.audit_status==3}])},[a.value.audit_status==1?(d(),i(o,{key:0,name:"clock"})):p("",!0),a.value.audit_status==3?(d(),i(o,{key:1,name:"clear"})):p("",!0),a.value.audit_status==2?(d(),i(o,{key:2,name:"checked"})):p("",!0),y(" "+_(j(a.value.audit_status))+_(a.value.report_status==2?"，已确认":"")+" ",1),m("p",null,_(a.value.reason),1)],2),m("div",me,[m("p",null,[m("span",null,[r(o,{name:"user"}),y(_(a.value.name),1)]),y(),m("span",null,[r(o,{name:"phone"}),y(_(a.value.phone),1)])]),m("p",null,[r(o,{name:"friends"}),y(" "+_(a.value.department),1)])]),m("div",ve,[ce,r(g,{"input-align":"right"},{default:s(()=>[r(u,{modelValue:a.value.activity_name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.activity_name=l),name:"",label:"服务内容:",readonly:"",placeholder:"服务内容"},null,8,["modelValue"]),r(u,{modelValue:a.value.leader_name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.leader_name=l),name:"",label:"负责人:",placeholder:"负责人",readonly:""},null,8,["modelValue"]),r(u,{modelValue:a.value.leader_phone,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.leader_phone=l),name:"",label:"手机号:",placeholder:"手机号",readonly:""},null,8,["modelValue"])]),_:1}),r(g,{"label-align":"top"},{default:s(()=>[_e,r(u,{readonly:""},{input:s(()=>[m("div",ye,[(d(!0),D(G,null,H(a.value.materials,l=>(d(),D("div",null,_(l.name)+" "+_(l.number)+" "+_(l.unit),1))),256))])]),_:1}),fe,r(u,{readonly:"",modelValue:a.value.usage_location,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.usage_location=l),name:"",label:"地点:",placeholder:"请输入地点",rules:[{required:!0,message:"请输入地点"}]},null,8,["modelValue"]),r(u,{readonly:"",label:"时间:",placeholder:"请选择使用时间",rules:[{required:!0,message:"请选择使用时间"}]},{input:s(()=>[y(_(a.value.usage_start_time)+" 至 "+_(a.value.usage_end_time),1)]),_:1}),r(u,{readonly:"",autosize:"",type:"textarea",rows:"2",maxlength:"100",modelValue:a.value.usage_reason,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.usage_reason=l),name:"",label:"原因:",placeholder:"请输入使用原因",rules:[{required:!0,message:"请输入使用原因"}]},null,8,["modelValue"]),r(u,{readonly:"",name:"uploader",label:"上传图片:"},{input:s(()=>[r(R,{readonly:"",deletable:!1,modelValue:a.value.attachment,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.attachment=l),"after-read":T,multiple:"","max-count":3},null,8,["modelValue"])]),_:1}),r(u,{readonly:"",name:"uploader",label:"上传文件:"},{input:s(()=>{var l,w,x;return[m("a",{download:(l=a.value.file[0])==null?void 0:l.name,href:(w=a.value.file[0])==null?void 0:w.url},_((x=a.value.file[0])==null?void 0:x.name),9,ge)]}),_:1}),r(u,{readonly:"",modelValue:a.value.remark,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.remark=l),autosize:"",type:"textarea",maxlength:"144",label:"备注:",placeholder:"备注"},null,8,["modelValue"]),a.value.audit_status==2&&a.value.report_reason?(d(),i(u,{key:0,readonly:"",modelValue:a.value.report_reason,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.report_reason=l),label:"报备理由:",autosize:"",type:"textarea"},null,8,["modelValue"])):p("",!0),a.value.audit_status==2&&a.value.report_reason?(d(),i(u,{key:1,readonly:"",modelValue:a.value.report_amount,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.report_amount=l),label:"活动金额:"},null,8,["modelValue"])):p("",!0),a.value.audit_status==2&&a.value.report_reason?(d(),i(u,{key:2,readonly:"",name:"uploader",label:"报备图片:"},{input:s(()=>[r(R,{readonly:"",deletable:!1,modelValue:a.value.report_image,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.report_image=l),"after-read":T,multiple:"","max-count":3},null,8,["modelValue"])]),_:1})):p("",!0),a.value.audit_status==2&&a.value.report_reason?(d(),i(u,{key:3,readonly:"",name:"uploader",label:"报备文件:"},{input:s(()=>{var l,w,x;return[m("a",{download:(l=a.value.report_file[0])==null?void 0:l.name,href:(w=a.value.report_file[0])==null?void 0:w.url},_((x=a.value.report_file[0])==null?void 0:x.name),9,be)]}),_:1})):p("",!0),m("div",he,[q(V)==2&&a.value.audit_status==1?(d(),i(b,{key:0,type:"primary",onClick:e[10]||(e[10]=l=>C(1)),round:"",block:""},{default:s(()=>[y("撤销")]),_:1})):p("",!0),q(V)==1&&a.value.audit_status==1?(d(),i(b,{key:1,type:"primary",onClick:e[11]||(e[11]=l=>C(2)),round:"",block:""},{default:s(()=>[y("通过")]),_:1})):p("",!0),q(V)==1&&a.value.audit_status==1?(d(),i(b,{key:2,type:"primary",onClick:e[12]||(e[12]=l=>C(3)),round:"",block:""},{default:s(()=>[y("驳回")]),_:1})):p("",!0),q(V)==1&&a.value.audit_status==2&&a.value.reporter_phone&&!a.value.report_reason?(d(),i(b,{key:3,type:"primary",onClick:e[13]||(e[13]=l=>C(4)),round:"",block:""},{default:s(()=>[y("报备")]),_:1})):p("",!0),q(V)==2&&a.value.audit_status==2&&a.value.report_status==1&&a.value.report_reason?(d(),i(b,{key:4,type:"primary",onClick:I,round:"",block:""},{default:s(()=>[y("确认")]),_:1})):p("",!0)])]),_:1})]),r(E,{show:k.value,"onUpdate:show":e[19]||(e[19]=l=>k.value=l),round:"",position:"bottom",class:"dialog",closeable:"",style:Q({height:c.value.height})},{default:s(()=>[m("h4",null,_(c.value.label),1),r(g,{"label-align":"top",onSubmit:B},{default:s(()=>[c.value.status!=4?(d(),i(u,{key:0,required:"",modelValue:v.value.reason,"onUpdate:modelValue":e[14]||(e[14]=l=>v.value.reason=l),autosize:"",type:"textarea",rows:"3",maxlength:"144","show-word-limit":"",label:c.value.placeholder,placeholder:c.value.placeholder,rules:[{required:!0,message:"理由必须输入"}]},null,8,["modelValue","label","placeholder"])):p("",!0),c.value.status==4?(d(),i(u,{key:1,required:"",modelValue:v.value.report_reason,"onUpdate:modelValue":e[15]||(e[15]=l=>v.value.report_reason=l),autosize:"",type:"textarea",rows:"3",maxlength:"144","show-word-limit":"",label:"报备理由:",placeholder:"请输入报备理由",rules:[{required:!0,message:"请输入报备理由"}]},null,8,["modelValue"])):p("",!0),c.value.status==4?(d(),i(u,{key:2,required:"",modelValue:v.value.report_amount,"onUpdate:modelValue":e[16]||(e[16]=l=>v.value.report_amount=l),type:"number","show-word-limit":"",label:"报备金额:",placeholder:"请输入报备金额",rules:[{required:!0,message:"请输入报备金额"}]},null,8,["modelValue"])):p("",!0),c.value.status==4?(d(),i(u,{key:3,name:"uploader",label:"上传图片:",rules:[{message:"必须上传图片"}]},{input:s(()=>[r(R,{modelValue:v.value.report_image,"onUpdate:modelValue":e[17]||(e[17]=l=>v.value.report_image=l),"after-read":T,multiple:"","max-count":3},null,8,["modelValue"])]),_:1})):p("",!0),c.value.status==4?(d(),i(u,{key:4,name:"uploader",label:"报备附件:",rules:[{message:"只能上传PDF,TXT,XLS,DOC文件"}]},{input:s(()=>[r(R,{"max-count":1,modelValue:n.value,"onUpdate:modelValue":e[18]||(e[18]=l=>n.value=l),"after-read":N,"before-read":A,accept:"text/plain, application/vnd.ms-excel, application/vnd.ms-works, application/msword, application/pdf"},{default:s(()=>[r(b,{icon:"plus",style:{width:"100px"},size:"small",type:"primary"},{default:s(()=>[y("报备附件")]),_:1})]),_:1},8,["modelValue"])]),_:1})):p("",!0),r(b,{type:"primary",round:"",block:"","native-type":"submit"},{default:s(()=>[y("确定")]),_:1})]),_:1})]),_:1},8,["show","style"])])}}});const qe=ie(Ve,[["__scopeId","data-v-3936c343"]]);export{qe as default};
