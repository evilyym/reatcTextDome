import{a as D,F as ke,t as ee,J as Ct,w as oe,x as Ke,y as Ge,v as Oe,z as r,f as ne,h as p,H as Je,K as U,D as se,m as Q,B as V,A as W,aR as Bt,aa as te,ay as ie,ac as $e,U as Qe,k as j,G as be,aS as pe,aT as xt,O as Pt,aU as et,aV as Ve,aW as It,T as Pe,j as Se,L as he,X as kt,aX as Tt,p as tt,C as ue,M as le,aY as Ie,aw as Rt,a0 as re,ar as Et,ax as zt,a3 as At,i as De,d as nt,Y as ze,aZ as Lt,a_ as Ot,a$ as $t,a1 as ve,a9 as at,b0 as Vt,b1 as Me,b2 as Dt,b3 as _t,Q as _e,b4 as ot,b5 as lt,aB as Ft,E as ye,aC as ce,r as Mt,b6 as Ue,aA as Ut,a8 as it,a6 as Nt,a4 as rt,av as Yt,a2 as Ne}from"./index-519eabe2.js";import{a as st,c as ct,d as Ht,u as jt,C as Wt,b as Xt,S as Zt}from"./_plugin-vue_export-helper-9acdd7cc.js";const qt=(e,a)=>{const o=D(),t=()=>{o.value=Oe(e).height};return ke(()=>{if(ee(t),a)for(let l=1;l<=3;l++)setTimeout(t,100*l)}),Ct(()=>ee(t)),oe([Ke,Ge],t),o};function Kt(e,a){const o=qt(e,!0);return t=>r("div",{class:a("placeholder"),style:{height:o.value?`${o.value}px`:void 0}},[t()])}const[ut,Ye]=ne("action-bar"),dt=Symbol(ut),Gt={placeholder:Boolean,safeAreaInsetBottom:U};var Jt=p({name:ut,props:Gt,setup(e,{slots:a}){const o=D(),t=Kt(o,Ye),{linkChildren:l}=Je(dt);l();const s=()=>{var S;return r("div",{ref:o,class:[Ye(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(S=a.default)==null?void 0:S.call(a)])};return()=>e.placeholder?t(s):s()}});const Qt=se(Jt),[pt,fe]=ne("button"),en=Q({},st,{tag:V("button"),text:String,icon:String,type:V("default"),size:V("normal"),color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,nativeType:V("button"),loadingSize:W,loadingText:String,loadingType:String,iconPosition:V("left")});var tn=p({name:pt,props:en,emits:["click"],setup(e,{emit:a,slots:o}){const t=ct(),l=()=>o.loading?o.loading():r($e,{size:e.loadingSize,type:e.loadingType,class:fe("loading")},null),s=()=>{if(e.loading)return l();if(o.icon)return r("div",{class:fe("icon")},[o.icon()]);if(e.icon)return r(te,{name:e.icon,class:fe("icon"),classPrefix:e.iconPrefix},null)},S=()=>{let m;if(e.loading?m=e.loadingText:m=o.default?o.default():e.text,m)return r("span",{class:fe("text")},[m])},y=()=>{const{color:m,plain:u}=e;if(m){const b={color:u?m:"white"};return u||(b.background=m),m.includes("gradient")?b.border=0:b.borderColor=m,b}},h=m=>{e.loading?ie(m):e.disabled||(a("click",m),t())};return()=>{const{tag:m,type:u,size:b,block:P,round:k,plain:R,square:L,loading:i,disabled:c,hairline:v,nativeType:g,iconPosition:w}=e,E=[fe([u,b,{plain:R,block:P,round:k,square:L,loading:i,disabled:c,hairline:v}]),{[Bt]:v}];return r(m,{type:g,class:E,style:y(),disabled:c,onClick:h},{default:()=>[r("div",{class:fe("content")},[w==="left"&&s(),S(),w==="right"&&s()])]})}}});const Ae=se(tn),[nn,an]=ne("action-bar-button"),on=Q({},st,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var ln=p({name:nn,props:on,setup(e,{slots:a}){const o=ct(),{parent:t,index:l}=Qe(dt),s=j(()=>{if(t){const y=t.children[l.value-1];return!(y&&"isButton"in y)}}),S=j(()=>{if(t){const y=t.children[l.value+1];return!(y&&"isButton"in y)}});return be({isButton:!0}),()=>{const{type:y,icon:h,text:m,color:u,loading:b,disabled:P}=e;return r(Ae,{class:an([y,{last:S.value,first:s.value}]),size:"large",type:y,icon:h,color:u,loading:b,disabled:P,onClick:o},{default:()=>[a.default?a.default():m]})}}});const He=se(ln),[rn,sn]=ne("form"),cn={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:W,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:U,showErrorMessage:U,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var un=p({name:rn,props:cn,emits:["submit","failed"],setup(e,{emit:a,slots:o}){const{children:t,linkChildren:l}=Je(pe),s=i=>i?t.filter(c=>i.includes(c.name)):t,S=i=>new Promise((c,v)=>{const g=[];s(i).reduce((E,_)=>E.then(()=>{if(!g.length)return _.validate().then(q=>{q&&g.push(q)})}),Promise.resolve()).then(()=>{g.length?v(g):c()})}),y=i=>new Promise((c,v)=>{const g=s(i);Promise.all(g.map(w=>w.validate())).then(w=>{w=w.filter(Boolean),w.length?v(w):c()})}),h=i=>{const c=t.find(v=>v.name===i);return c?new Promise((v,g)=>{c.validate().then(w=>{w?g(w):v()})}):Promise.reject()},m=i=>typeof i=="string"?h(i):e.validateFirst?S(i):y(i),u=i=>{typeof i=="string"&&(i=[i]),s(i).forEach(v=>{v.resetValidation()})},b=()=>t.reduce((i,c)=>(i[c.name]=c.getValidationStatus(),i),{}),P=(i,c)=>{t.some(v=>v.name===i?(v.$el.scrollIntoView(c),!0):!1)},k=()=>t.reduce((i,c)=>(c.name!==void 0&&(i[c.name]=c.formValue.value),i),{}),R=()=>{const i=k();m().then(()=>a("submit",i)).catch(c=>{a("failed",{values:i,errors:c}),e.scrollToError&&c[0].name&&P(c[0].name)})},L=i=>{ie(i),R()};return l({props:e}),be({submit:R,validate:m,getValues:k,scrollToField:P,resetValidation:u,getValidationStatus:b}),()=>{var i;return r("form",{class:sn(),onSubmit:L},[(i=o.default)==null?void 0:i.call(o)])}}});const Gn=se(un);function ft(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function dn(e,a){if(ft(e)){if(a.required)return!1;if(a.validateEmpty===!1)return!0}return!(a.pattern&&!a.pattern.test(String(e)))}function fn(e,a){return new Promise(o=>{const t=a.validator(e,a);if(et(t)){t.then(o);return}o(t)})}function je(e,a){const{message:o}=a;return Ve(o)?o(e,a):o||""}function gn({target:e}){e.composing=!0}function We({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function mn(e,a){const o=xt();e.style.height="auto";let t=e.scrollHeight;if(It(a)){const{maxHeight:l,minHeight:s}=a;l!==void 0&&(t=Math.min(t,l)),s!==void 0&&(t=Math.max(t,s))}t&&(e.style.height=`${t}px`,Pt(o))}function vn(e){return e==="number"?{type:"text",inputmode:"decimal"}:e==="digit"?{type:"tel",inputmode:"numeric"}:{type:e}}function ae(e){return[...e].length}function Re(e,a){return[...e].slice(0,a).join("")}const[hn,Z]=ne("field"),bn={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:W,formatter:Function,clearIcon:V("clear"),modelValue:ue(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:V("focus"),formatTrigger:V("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},wn=Q({},Ht,bn,{rows:W,type:V("text"),rules:Array,autosize:[Boolean,Object],labelWidth:W,labelClass:Pe,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var yn=p({name:hn,props:wn,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:a,slots:o}){const t=jt(),l=Se({status:"unvalidated",focused:!1,validateMessage:""}),s=D(),S=D(),y=D(),{parent:h}=Qe(pe),m=()=>{var n;return String((n=e.modelValue)!=null?n:"")},u=n=>{if(le(e[n]))return e[n];if(h&&le(h.props[n]))return h.props[n]},b=j(()=>{const n=u("readonly");if(e.clearable&&!n){const B=m()!=="",x=e.clearTrigger==="always"||e.clearTrigger==="focus"&&l.focused;return B&&x}return!1}),P=j(()=>y.value&&o.input?y.value():e.modelValue),k=j(()=>{var n;const B=u("required");return B==="auto"?(n=e.rules)==null?void 0:n.some(x=>x.required):B}),R=n=>n.reduce((B,x)=>B.then(()=>{if(l.status==="failed")return;let{value:z}=P;if(x.formatter&&(z=x.formatter(z,x)),!dn(z,x)){l.status="failed",l.validateMessage=je(z,x);return}if(x.validator)return ft(z)&&x.validateEmpty===!1?void 0:fn(z,x).then($=>{$&&typeof $=="string"?(l.status="failed",l.validateMessage=$):$===!1&&(l.status="failed",l.validateMessage=je(z,x))})}),Promise.resolve()),L=()=>{l.status="unvalidated",l.validateMessage=""},i=()=>a("endValidate",{status:l.status,message:l.validateMessage}),c=(n=e.rules)=>new Promise(B=>{L(),n?(a("startValidate"),R(n).then(()=>{l.status==="failed"?(B({name:e.name,message:l.validateMessage}),i()):(l.status="passed",B(),i())})):B()}),v=n=>{if(h&&e.rules){const{validateTrigger:B}=h.props,x=Ie(B).includes(n),z=e.rules.filter($=>$.trigger?Ie($.trigger).includes(n):x);z.length&&c(z)}},g=n=>{var B;const{maxlength:x}=e;if(le(x)&&ae(n)>+x){const z=m();if(z&&ae(z)===+x)return z;const $=(B=s.value)==null?void 0:B.selectionEnd;if(l.focused&&$){const Y=[...n],G=Y.length-+x;return Y.splice($-G,G),Y.join("")}return Re(n,+x)}return n},w=(n,B="onChange")=>{const x=n;n=g(n);const z=ae(x)-ae(n);if(e.type==="number"||e.type==="digit"){const Y=e.type==="number";n=Rt(n,Y,Y)}let $=0;if(e.formatter&&B===e.formatTrigger){const{formatter:Y,maxlength:G}=e;if(n=Y(n),le(G)&&ae(n)>+G&&(n=Re(n,+G)),s.value&&l.focused){const{selectionEnd:Ce}=s.value,Fe=Re(x,Ce);$=ae(Y(Fe))-ae(Fe)}}if(s.value&&s.value.value!==n)if(l.focused){let{selectionStart:Y,selectionEnd:G}=s.value;if(s.value.value=n,le(Y)&&le(G)){const Ce=ae(n);z?(Y-=z,G-=z):$&&(Y+=$,G+=$),s.value.setSelectionRange(Math.min(Y,Ce),Math.min(G,Ce))}}else s.value.value=n;n!==e.modelValue&&a("update:modelValue",n)},E=n=>{n.target.composing||w(n.target.value)},_=()=>{var n;return(n=s.value)==null?void 0:n.blur()},q=()=>{var n;return(n=s.value)==null?void 0:n.focus()},d=()=>{const n=s.value;e.type==="textarea"&&e.autosize&&n&&mn(n,e.autosize)},I=n=>{l.focused=!0,a("focus",n),ee(d),u("readonly")&&_()},F=n=>{l.focused=!1,w(m(),"onBlur"),a("blur",n),!u("readonly")&&(v("onBlur"),ee(d),zt())},A=n=>a("clickInput",n),H=n=>a("clickLeftIcon",n),X=n=>a("clickRightIcon",n),we=n=>{ie(n),a("update:modelValue",""),a("clear",n)},f=j(()=>{if(typeof e.error=="boolean")return e.error;if(h&&h.props.showError&&l.status==="failed")return!0}),C=j(()=>{const n=u("labelWidth"),B=u("labelAlign");if(n&&B!=="top")return{width:he(n)}}),T=n=>{n.keyCode===13&&(!(h&&h.props.submitOnEnter)&&e.type!=="textarea"&&ie(n),e.type==="search"&&_()),a("keypress",n)},M=()=>e.id||`${t}-input`,N=()=>l.status,K=()=>{const n=Z("control",[u("inputAlign"),{error:f.value,custom:!!o.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(o.input)return r("div",{class:n,onClick:A},[o.input()]);const B={id:M(),ref:s,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:n,disabled:u("disabled"),readonly:u("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${t}-label`:void 0,onBlur:F,onFocus:I,onInput:E,onClick:A,onChange:We,onKeypress:T,onCompositionend:We,onCompositionstart:gn};return e.type==="textarea"?r("textarea",B,null):r("input",re(vn(e.type),B),null)},de=()=>{const n=o["left-icon"];if(e.leftIcon||n)return r("div",{class:Z("left-icon"),onClick:H},[n?n():r(te,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},Te=()=>{const n=o["right-icon"];if(e.rightIcon||n)return r("div",{class:Z("right-icon"),onClick:X},[n?n():r(te,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},bt=()=>{if(e.showWordLimit&&e.maxlength){const n=ae(m());return r("div",{class:Z("word-limit")},[r("span",{class:Z("word-num")},[n]),Et("/"),e.maxlength])}},wt=()=>{if(h&&h.props.showErrorMessage===!1)return;const n=e.errorMessage||l.validateMessage;if(n){const B=o["error-message"],x=u("errorMessageAlign");return r("div",{class:Z("error-message",x)},[B?B({message:n}):n])}},yt=()=>{const n=u("labelWidth"),B=u("labelAlign"),x=u("colon")?":":"";if(o.label)return[o.label(),x];if(e.label)return r("label",{id:`${t}-label`,for:o.input?void 0:M(),onClick:z=>{ie(z),q()},style:B==="top"&&n?{width:he(n)}:void 0},[e.label+x])},St=()=>[r("div",{class:Z("body")},[K(),b.value&&r(te,{ref:S,name:e.clearIcon,class:Z("clear")},null),Te(),o.button&&r("div",{class:Z("button")},[o.button()])]),bt(),wt()];return be({blur:_,focus:q,validate:c,formValue:P,resetValidation:L,getValidationStatus:N}),kt(Tt,{customValue:y,resetValidation:L,validateWithTrigger:v}),oe(()=>e.modelValue,()=>{w(m()),L(),v("onChange"),ee(d)}),ke(()=>{w(m(),e.formatTrigger),ee(d)}),tt("touchstart",we,{target:j(()=>{var n;return(n=S.value)==null?void 0:n.$el})}),()=>{const n=u("disabled"),B=u("labelAlign"),x=de(),z=()=>{const $=yt();return B==="top"?[x,$].filter(Boolean):$||[]};return r(Wt,{size:e.size,class:Z({error:f.value,disabled:n,[`label-${B}`]:B}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:C.value,valueClass:Z("value"),titleClass:[Z("label",[B,{required:k.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:x&&B!=="top"?()=>x:null,title:z,value:St,extra:o.extra})}}});const Jn=se(yn),[Sn,ge]=ne("image"),Cn={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:W,height:W,radius:W,lazyLoad:Boolean,iconSize:W,showError:U,errorIcon:V("photo-fail"),iconPrefix:String,showLoading:U,loadingIcon:V("photo")};var Bn=p({name:Sn,props:Cn,emits:["load","error"],setup(e,{emit:a,slots:o}){const t=D(!1),l=D(!0),s=D(),{$Lazyload:S}=At().proxy,y=j(()=>{const i={width:he(e.width),height:he(e.height)};return le(e.radius)&&(i.overflow="hidden",i.borderRadius=he(e.radius)),i});oe(()=>e.src,()=>{t.value=!1,l.value=!0});const h=i=>{l.value&&(l.value=!1,a("load",i))},m=()=>{const i=new Event("load");Object.defineProperty(i,"target",{value:s.value,enumerable:!0}),h(i)},u=i=>{t.value=!0,l.value=!1,a("error",i)},b=(i,c,v)=>v?v():r(te,{name:i,size:e.iconSize,class:c,classPrefix:e.iconPrefix},null),P=()=>{if(l.value&&e.showLoading)return r("div",{class:ge("loading")},[b(e.loadingIcon,ge("loading-icon"),o.loading)]);if(t.value&&e.showError)return r("div",{class:ge("error")},[b(e.errorIcon,ge("error-icon"),o.error)])},k=()=>{if(t.value||!e.src)return;const i={alt:e.alt,class:ge("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?ze(r("img",re({ref:s},i),null),[[Lt("lazy"),e.src]]):r("img",re({ref:s,src:e.src,onLoad:h,onError:u},i),null)},R=({el:i})=>{const c=()=>{i===s.value&&l.value&&m()};s.value?c():ee(c)},L=({el:i})=>{i===s.value&&!t.value&&u()};return S&&De&&(S.$on("loaded",R),S.$on("error",L),nt(()=>{S.$off("loaded",R),S.$off("error",L)})),ke(()=>{ee(()=>{var i;(i=s.value)!=null&&i.complete&&!e.lazyLoad&&m()})}),()=>{var i;return r("div",{class:ge({round:e.round,block:e.block}),style:y.value},[k(),P(),(i=o.default)==null?void 0:i.call(o)])}}});const gt=se(Bn),[xn,J,Be]=ne("dialog"),Pn=Q({},Ot,{title:String,theme:String,width:W,message:[String,Function],callback:Function,allowHtml:Boolean,className:Pe,transition:V("van-dialog-bounce"),messageAlign:String,closeOnPopstate:U,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:U,closeOnClickOverlay:Boolean}),In=[...$t,"transition","closeOnPopstate"];var kn=p({name:xn,props:Pn,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:a,slots:o}){const t=D(),l=Se({confirm:!1,cancel:!1}),s=c=>a("update:show",c),S=c=>{var v;s(!1),(v=e.callback)==null||v.call(e,c)},y=c=>()=>{e.show&&(a(c),e.beforeClose?(l[c]=!0,_e(e.beforeClose,{args:[c],done(){S(c),l[c]=!1},canceled(){l[c]=!1}})):S(c))},h=y("cancel"),m=y("confirm"),u=Vt(c=>{var v,g;if(c.target!==((g=(v=t.value)==null?void 0:v.popupRef)==null?void 0:g.value))return;({Enter:e.showConfirmButton?m:Me,Escape:e.showCancelButton?h:Me})[c.key](),a("keydown",c)},["enter","esc"]),b=()=>{const c=o.title?o.title():e.title;if(c)return r("div",{class:J("header",{isolated:!e.message&&!o.default})},[c])},P=c=>{const{message:v,allowHtml:g,messageAlign:w}=e,E=J("message",{"has-title":c,[w]:w}),_=Ve(v)?v():v;return g&&typeof _=="string"?r("div",{class:E,innerHTML:_},null):r("div",{class:E},[_])},k=()=>{if(o.default)return r("div",{class:J("content")},[o.default()]);const{title:c,message:v,allowHtml:g}=e;if(v){const w=!!(c||o.title);return r("div",{key:g?1:0,class:J("content",{isolated:!w})},[P(w)])}},R=()=>r("div",{class:[_t,J("footer")]},[e.showCancelButton&&r(Ae,{size:"large",text:e.cancelButtonText||Be("cancel"),class:J("cancel"),style:{color:e.cancelButtonColor},loading:l.cancel,disabled:e.cancelButtonDisabled,onClick:h},null),e.showConfirmButton&&r(Ae,{size:"large",text:e.confirmButtonText||Be("confirm"),class:[J("confirm"),{[Dt]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:l.confirm,disabled:e.confirmButtonDisabled,onClick:m},null)]),L=()=>r(Qt,{class:J("footer")},{default:()=>[e.showCancelButton&&r(He,{type:"warning",text:e.cancelButtonText||Be("cancel"),class:J("cancel"),color:e.cancelButtonColor,loading:l.cancel,disabled:e.cancelButtonDisabled,onClick:h},null),e.showConfirmButton&&r(He,{type:"danger",text:e.confirmButtonText||Be("confirm"),class:J("confirm"),color:e.confirmButtonColor,loading:l.confirm,disabled:e.confirmButtonDisabled,onClick:m},null)]}),i=()=>o.footer?o.footer():e.theme==="round-button"?L():R();return()=>{const{width:c,title:v,theme:g,message:w,className:E}=e;return r(at,re({ref:t,role:"dialog",class:[J([g]),E],style:{width:he(c)},tabindex:0,"aria-labelledby":v||w,onKeydown:u,"onUpdate:show":s},ve(e,In)),{default:()=>[b(),k(),i()]})}}});let Le;const Tn={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let Rn=Q({},Tn);function En(){({instance:Le}=ot({setup(){const{state:a,toggle:o}=lt();return()=>r(kn,re(a,{"onUpdate:show":o}),null)}}))}function zn(e){return De?new Promise((a,o)=>{Le||En(),Le.open(Q({},Rn,e,{callback:t=>{(t==="confirm"?a:o)(t)}}))}):Promise.resolve(void 0)}const Qn=e=>zn(Q({showCancelButton:!0},e)),Xe=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),An=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),Ee=ne("image-preview")[1],Ze=2.6,Ln={src:String,show:Boolean,active:Number,minZoom:ye(W),maxZoom:ye(W),rootWidth:ye(Number),rootHeight:ye(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean};var On=p({props:Ln,emits:["scale","close","longPress"],setup(e,{emit:a,slots:o}){const t=Se({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),l=Ft(),s=D(),S=D(),y=D(!1),h=D(!1);let m=0;const u=j(()=>{const{scale:f,moveX:C,moveY:T,moving:M,zooming:N,initializing:K}=t,de={transitionDuration:N||M||K?"0s":".3s"};return(f!==1||h.value)&&(de.transform=`matrix(${f}, 0, 0, ${f}, ${C}, ${T})`),de}),b=j(()=>{if(t.imageRatio){const{rootWidth:f,rootHeight:C}=e,T=y.value?C/t.imageRatio:f;return Math.max(0,(t.scale*T-f)/2)}return 0}),P=j(()=>{if(t.imageRatio){const{rootWidth:f,rootHeight:C}=e,T=y.value?C:f*t.imageRatio;return Math.max(0,(t.scale*T-C)/2)}return 0}),k=(f,C)=>{var T;if(f=ce(f,+e.minZoom,+e.maxZoom+1),f!==t.scale){const M=f/t.scale;if(t.scale=f,C){const N=Oe((T=s.value)==null?void 0:T.$el),K={x:N.width*.5,y:N.height*.5},de=t.moveX-(C.x-N.left-K.x)*(M-1),Te=t.moveY-(C.y-N.top-K.y)*(M-1);t.moveX=ce(de,-b.value,b.value),t.moveY=ce(Te,-P.value,P.value)}else t.moveX=0,t.moveY=h.value?m:0;a("scale",{scale:f,index:e.active})}},R=()=>{k(1)},L=()=>{const f=t.scale>1?1:2;k(f,f===2||h.value?{x:l.startX.value,y:l.startY.value}:void 0)};let i,c,v,g,w,E,_,q,d=!1;const I=f=>{const{touches:C}=f;if(i=C.length,i===2&&e.disableZoom)return;const{offsetX:T}=l;l.start(f),c=t.moveX,v=t.moveY,q=Date.now(),d=!1,t.moving=i===1&&(t.scale!==1||h.value),t.zooming=i===2&&!T.value,t.zooming&&(g=t.scale,w=Xe(C))},F=f=>{const{touches:C}=f;if(l.move(f),t.moving){const{deltaX:T,deltaY:M}=l,N=T.value+c,K=M.value+v;if((N>b.value||N<-b.value)&&!d&&l.isHorizontal()){t.moving=!1;return}d=!0,ie(f,!0),t.moveX=ce(N,-b.value,b.value),t.moveY=ce(K,-P.value,P.value)}if(t.zooming&&(ie(f,!0),C.length===2)){const T=Xe(C),M=g*T/w;E=An(C),k(M,E)}},A=f=>{var C;if(i>1)return;const{offsetX:T,offsetY:M}=l,N=Date.now()-q,K=250;if(T.value<Ue&&M.value<Ue)if(N<K)if(e.doubleScale)if(_)clearTimeout(_),_=null,L();else{if(!e.closeOnClickOverlay&&f.target===((C=S.value)==null?void 0:C.$el))return;_=setTimeout(()=>{a("close"),_=null},K)}else a("close");else N>Ut&&a("longPress")},H=f=>{let C=!1;if((t.moving||t.zooming)&&(C=!0,t.moving&&c===t.moveX&&v===t.moveY&&(C=!1),!f.touches.length)){t.zooming&&(t.moveX=ce(t.moveX,-b.value,b.value),t.moveY=ce(t.moveY,-P.value,P.value),t.zooming=!1),t.moving=!1,c=0,v=0,g=1,t.scale<1&&R();const T=+e.maxZoom;t.scale>T&&k(T,E)}ie(f,C),A(f),l.reset()},X=()=>{const{rootWidth:f,rootHeight:C}=e,T=C/f,{imageRatio:M}=t;y.value=t.imageRatio>T&&M<Ze,h.value=t.imageRatio>T&&M>=Ze,h.value&&(m=(M*f-C)/2,t.moveY=m,t.initializing=!0,Mt(()=>{t.initializing=!1})),R()},we=f=>{const{naturalWidth:C,naturalHeight:T}=f.target;t.imageRatio=T/C,X()};return oe(()=>e.active,R),oe(()=>e.show,f=>{f||R()}),oe(()=>[e.rootWidth,e.rootHeight],X),tt("touchmove",F,{target:j(()=>{var f;return(f=S.value)==null?void 0:f.$el})}),be({resetScale:R}),()=>{const f={loading:()=>r($e,{type:"spinner"},null)};return r(Xt,{ref:S,class:Ee("swipe-item"),onTouchstartPassive:I,onTouchend:H,onTouchcancel:H},{default:()=>[o.image?r("div",{class:Ee("image-wrap")},[o.image({src:e.src})]):r(gt,{ref:s,src:e.src,fit:"contain",class:Ee("image",{vertical:y.value}),style:u.value,onLoad:we},f)]})}}});const[$n,me]=ne("image-preview"),Vn=["show","teleport","transition","overlayStyle","closeOnPopstate"],Dn={show:Boolean,loop:U,images:it(),minZoom:ue(1/3),maxZoom:ue(3),overlay:U,closeable:Boolean,showIndex:U,className:Pe,closeIcon:V("clear"),transition:String,beforeClose:Function,doubleScale:U,overlayClass:Pe,overlayStyle:Object,swipeDuration:ue(300),startPosition:ue(0),showIndicators:Boolean,closeOnPopstate:U,closeOnClickOverlay:U,closeIconPosition:V("top-right"),teleport:[String,Object]};var mt=p({name:$n,props:Dn,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:a,slots:o}){const t=D(),l=D(),s=Se({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),S=()=>{if(t.value){const g=Oe(t.value.$el);s.rootWidth=g.width,s.rootHeight=g.height,t.value.resize()}},y=g=>a("scale",g),h=g=>a("update:show",g),m=()=>{_e(e.beforeClose,{args:[s.active],done:()=>h(!1)})},u=g=>{g!==s.active&&(s.active=g,a("change",g))},b=()=>{if(e.showIndex)return r("div",{class:me("index")},[o.index?o.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},P=()=>{if(o.cover)return r("div",{class:me("cover")},[o.cover()])},k=()=>{s.disableZoom=!0},R=()=>{s.disableZoom=!1},L=()=>r(Zt,{ref:t,lazyRender:!0,loop:e.loop,class:me("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u,onDragEnd:R,onDragStart:k},{default:()=>[e.images.map((g,w)=>r(On,{ref:E=>{w===s.active&&(l.value=E)},src:g,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,doubleScale:e.doubleScale,closeOnClickOverlay:e.closeOnClickOverlay,onScale:y,onClose:m,onLongPress:()=>a("longPress",{index:w})},{image:o.image}))]}),i=()=>{if(e.closeable)return r(te,{role:"button",name:e.closeIcon,class:[me("close-icon",e.closeIconPosition),Nt],onClick:m},null)},c=()=>a("closed"),v=(g,w)=>{var E;return(E=t.value)==null?void 0:E.swipeTo(g,w)};return be({resetScale:()=>{var g;(g=l.value)==null||g.resetScale()},swipeTo:v}),ke(S),oe([Ke,Ge],S),oe(()=>e.startPosition,g=>u(+g)),oe(()=>e.show,g=>{const{images:w,startPosition:E}=e;g?(u(+E),ee(()=>{S(),v(+E,{immediate:!0})})):a("close",{index:s.active,url:w[s.active]})}),()=>r(at,re({class:[me(),e.className],overlayClass:[me("overlay"),e.overlayClass],onClosed:c,"onUpdate:show":h},ve(e,Vn)),{default:()=>[i(),L(),b(),P()]})}});let xe;const _n={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function Fn(){({instance:xe}=ot({setup(){const{state:e,toggle:a}=lt(),o=()=>{e.images=[]};return()=>r(mt,re(e,{onClosed:o,"onUpdate:show":a}),null)}}))}const Mn=(e,a=0)=>{if(De)return xe||Fn(),e=Array.isArray(e)?{images:e,startPosition:a}:e,xe.open(Q({},_n,e)),xe};se(mt);const[Un,O,Nn]=ne("uploader");function qe(e,a){return new Promise(o=>{if(a==="file"){o();return}const t=new FileReader;t.onload=l=>{o(l.target.result)},a==="dataUrl"?t.readAsDataURL(e):a==="text"&&t.readAsText(e)})}function vt(e,a){return Ie(e).some(o=>o.file?Ve(a)?a(o.file):o.file.size>+a:!1)}function Yn(e,a){const o=[],t=[];return e.forEach(l=>{vt(l,a)?t.push(l):o.push(l)}),{valid:o,invalid:t}}const Hn=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,jn=e=>Hn.test(e);function ht(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?jn(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Wn=p({props:{name:W,item:ye(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:a,slots:o}){const t=()=>{const{status:u,message:b}=e.item;if(u==="uploading"||u==="failed"){const P=u==="failed"?r(te,{name:"close",class:O("mask-icon")},null):r($e,{class:O("loading")},null),k=le(b)&&b!=="";return r("div",{class:O("mask")},[P,k&&r("div",{class:O("mask-message")},[b])])}},l=u=>{const{name:b,item:P,index:k,beforeDelete:R}=e;u.stopPropagation(),_e(R,{args:[P,{name:b,index:k}],done:()=>a("delete")})},s=()=>a("preview"),S=()=>a("reupload"),y=()=>{if(e.deletable&&e.item.status!=="uploading"){const u=o["preview-delete"];return r("div",{role:"button",class:O("preview-delete",{shadow:!u}),tabindex:0,"aria-label":Nn("delete"),onClick:l},[u?u():r(te,{name:"cross",class:O("preview-delete-icon")},null)])}},h=()=>{if(o["preview-cover"]){const{index:u,item:b}=e;return r("div",{class:O("preview-cover")},[o["preview-cover"](Q({index:u},b))])}},m=()=>{const{item:u,lazyLoad:b,imageFit:P,previewSize:k,reupload:R}=e;return ht(u)?r(gt,{fit:P,src:u.objectUrl||u.content||u.url,class:O("preview-image"),width:Array.isArray(k)?k[0]:k,height:Array.isArray(k)?k[1]:k,lazyLoad:b,onClick:R?S:s},{default:h}):r("div",{class:O("file"),style:rt(e.previewSize)},[r(te,{class:O("file-icon"),name:"description"},null),r("div",{class:[O("file-name"),"van-ellipsis"]},[u.file?u.file.name:u.url]),h()])};return()=>r("div",{class:O("preview")},[m(),t(),y()])}});const Xn={name:ue(""),accept:V("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:ue(1/0),imageFit:V("cover"),resultType:V("dataUrl"),uploadIcon:V("photograph"),uploadText:String,deletable:U,reupload:Boolean,afterRead:Function,showUpload:U,modelValue:it(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:U,previewOptions:Object,previewFullImage:U,maxSize:{type:[Number,String,Function],default:1/0}};var Zn=p({name:Un,props:Xn,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:a,slots:o}){const t=D(),l=[],s=D(-1),S=D(!1),y=(d=e.modelValue.length)=>({name:e.name,index:d}),h=()=>{t.value&&(t.value.value="")},m=d=>{if(h(),vt(d,e.maxSize))if(Array.isArray(d)){const I=Yn(d,e.maxSize);if(d=I.valid,a("oversize",I.invalid,y()),!d.length)return}else{a("oversize",d,y());return}if(d=Se(d),s.value>-1){const I=[...e.modelValue];I.splice(s.value,1,d),a("update:modelValue",I),s.value=-1}else a("update:modelValue",[...e.modelValue,...Ie(d)]);e.afterRead&&e.afterRead(d,y())},u=d=>{const{maxCount:I,modelValue:F,resultType:A}=e;if(Array.isArray(d)){const H=+I-F.length;d.length>H&&(d=d.slice(0,H)),Promise.all(d.map(X=>qe(X,A))).then(X=>{const we=d.map((f,C)=>{const T={file:f,status:"",message:"",objectUrl:URL.createObjectURL(f)};return X[C]&&(T.content=X[C]),T});m(we)})}else qe(d,A).then(H=>{const X={file:d,status:"",message:"",objectUrl:URL.createObjectURL(d)};H&&(X.content=H),m(X)})},b=d=>{const{files:I}=d.target;if(e.disabled||!I||!I.length)return;const F=I.length===1?I[0]:[].slice.call(I);if(e.beforeRead){const A=e.beforeRead(F,y());if(!A){h();return}if(et(A)){A.then(H=>{u(H||F)}).catch(h);return}}u(F)};let P;const k=()=>a("closePreview"),R=d=>{if(e.previewFullImage){const I=e.modelValue.filter(ht),F=I.map(A=>(A.objectUrl&&!A.url&&A.status!=="failed"&&(A.url=A.objectUrl,l.push(A.url)),A.url)).filter(Boolean);P=Mn(Q({images:F,startPosition:I.indexOf(d),onClose:k},e.previewOptions))}},L=()=>{P&&P.close()},i=(d,I)=>{const F=e.modelValue.slice(0);F.splice(I,1),a("update:modelValue",F),a("delete",d,y(I))},c=d=>{S.value=!0,s.value=d,ee(()=>q())},v=()=>{S.value||(s.value=-1),S.value=!1},g=(d,I)=>{const F=["imageFit","deletable","reupload","previewSize","beforeDelete"],A=Q(ve(e,F),ve(d,F,!0));return r(Wn,re({item:d,index:I,onClick:()=>a(e.reupload?"clickReupload":"clickPreview",d,y(I)),onDelete:()=>i(d,I),onPreview:()=>R(d),onReupload:()=>c(I)},ve(e,["name","lazyLoad"]),A),ve(o,["preview-cover","preview-delete"]))},w=()=>{if(e.previewImage)return e.modelValue.map(g)},E=d=>a("clickUpload",d),_=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const d=e.modelValue.length>=+e.maxCount&&e.reupload,I=e.readonly?null:r("input",{ref:t,type:"file",class:O("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&s.value===-1,disabled:e.disabled,onChange:b,onClick:v},null);return o.default?ze(r("div",{class:O("input-wrapper"),onClick:E},[o.default(),I]),[[Ne,!d]]):ze(r("div",{class:O("upload",{readonly:e.readonly}),style:rt(e.previewSize),onClick:E},[r(te,{name:e.uploadIcon,class:O("upload-icon")},null),e.uploadText&&r("span",{class:O("upload-text")},[e.uploadText]),I]),[[Ne,e.showUpload&&!d]])},q=()=>{t.value&&!e.disabled&&t.value.click()};return nt(()=>{l.forEach(d=>URL.revokeObjectURL(d))}),be({chooseFile:q,closeImagePreview:L}),Yt(()=>e.modelValue),()=>r("div",{class:O()},[r("div",{class:O("wrapper",{disabled:e.disabled})},[w(),_()])])}});const pn=se(Zn);export{Ae as B,Gn as F,pn as U,Qn as a,Jn as b,kn as s};
