import{h as O,ad as P,R as L,a as b,F as M,aM as X,ae as F,al as p,ao as d,ap as i,ar as c,aq as _,Z as K,z as r,af as n,$ as Q,a9 as Z,ak as s,am as G,an as H,ag as q,as as J,at as W,aN as Y,aO as ee,aP as ae,au as le,aK as z,aa as te,aQ as ue}from"./index-e9eaeb54.js";import{F as oe,b as re,U as ne,B as se,a as de}from"./index-ef9c0118.js";import{_ as ie}from"./_plugin-vue_export-helper-00dc462c.js";const B=U=>(J("data-v-7ae6f9f5"),U=U(),W(),U),pe={class:"eventDetails"},me={class:"userInfo"},ve={class:"activityInfo"},_e=B(()=>p("h4",null,"活动信息",-1)),ce=B(()=>p("h5",null,"申请材料",-1)),ye={class:"materialsBox"},fe=B(()=>p("h5",null,"使用信息",-1)),ge=["download","href"],be=["download","href"],he={style:{margin:"16px"},class:"btnBox"},Ve=O({__name:"index",setup(U){const f=P(),h=f.currentRoute.value.query.userType||L("$active"),V=b(!1),D=async()=>{let t,e;switch(v.value.status){case 2:case 3:e={...m.value,id:f.currentRoute.value.query.id,status:v.value.status},t=await ee(e);break;case 4:const o=b([]);m.value.report_image&&m.value.report_image.forEach(u=>{o.value.push(u.url)}),e={...m.value,id:f.currentRoute.value.query.id,report_image:o.value,file:y.value.length>0?y.value[0]:null},t=await Y(e);break}V.value=!1,t.code==200&&setTimeout(()=>{f.go(f.currentRoute.value.query.userType?0:-1)},500)},I=async()=>{const t={id:f.currentRoute.value.query.id};(await ae(t)).code==200&&setTimeout(()=>{f.go(f.currentRoute.value.query.userType?0:-1)},500)},S=()=>{de({message:"确定要撤销申请?"}).then(()=>{$()}).catch(()=>{})},y=b([]),$=async()=>{const t={id:f.currentRoute.value.query.id};(await ue(t)).code==200&&setTimeout(()=>{f.go(-1)},300)},v=b({label:"",status:null,placeholder:"",height:"40%"}),m=b({report_image:[]}),C=t=>{switch(V.value=!0,t){case 1:V.value=!1,S();break;case 2:v.value={label:"同意",status:t,placeholder:"同意理由:",height:"40%"};break;case 3:v.value={label:"驳回",status:t,placeholder:"驳回理由:",height:"40%"};break;case 4:v.value={label:"报备",status:t,placeholder:"",height:"70%"};break}},a=b({activity:{},file:[]}),N=t=>{const e=["pdf","docx","doc","txt","xlsx","xls"];return e.indexOf(t.name.split(".").reverse()[0])==-1?(le("只能上传"+e.join()+"文件"),!1):!0},T=async t=>{if(t instanceof Array)for(let e=0;e<t.length;e++){let o=t[e].file,u=new FormData;u.append("file",o,o.name),u.append("type","2");const k=await z(u);m.value.report_image[e].url=k.data.url}else{let e=t.file,o=new FormData;o.append("file",e,e.name),o.append("type","2");const u=await z(o);m.value.report_image[m.value.report_image.length-1].url=u.data.url}},A=async t=>{let e=t.file,o=new FormData;o.append("file",e,e.name),o.append("type","1");const u=await z(o);y.value[y.value.length-1].url=u.data.url,y.value[y.value.length-1].name=e.name,y.value[y.value.length-1].file_tpye=e.type,delete y.value[y.value.length-1].objectUrl},E=t=>{switch(t){case 1:return"待审核";case 2:return"审核通过";case 3:return"审核驳回"}};return M(async()=>{const t=(await X({id:f.currentRoute.value.query.id})).data;t.file=t.file?[t.file]:[],t.report_file=t.report_file?[t.report_file]:[],a.value=t,a.value.attachment?a.value.attachment.forEach((e,o)=>{a.value.attachment[o]={url:e}}):a.value.attachment=[],a.value.report_image?a.value.report_image.forEach((e,o)=>{e&&(a.value.report_image[o]={url:e})}):a.value.report_image=[]}),(t,e)=>{const o=te,u=re,k=oe,R=ne,g=se,j=Z;return s(),F("div",pe,[p("div",{class:K(["activityState",{back_blue:a.value.audit_status==1,back_green:a.value.audit_status==2,back_red:a.value.audit_status==3}])},[a.value.audit_status==1?(s(),d(o,{key:0,name:"clock"})):i("",!0),a.value.audit_status==3?(s(),d(o,{key:1,name:"clear"})):i("",!0),a.value.audit_status==2?(s(),d(o,{key:2,name:"checked"})):i("",!0),c(" "+_(E(a.value.audit_status))+_(a.value.report_status==2?"，已确认":"")+" ",1),p("p",null,_(a.value.reason),1)],2),p("div",me,[p("p",null,[p("span",null,[r(o,{name:"user"}),c(_(a.value.name),1)]),c(),p("span",null,[r(o,{name:"phone"}),c(_(a.value.phone),1)])]),p("p",null,[r(o,{name:"friends"}),c(" "+_(a.value.department),1)])]),p("div",ve,[_e,r(k,{"input-align":"right"},{default:n(()=>[r(u,{modelValue:a.value.activity_name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.activity_name=l),name:"",label:"服务内容:",readonly:"",placeholder:"服务内容"},null,8,["modelValue"]),r(u,{modelValue:a.value.leader_name,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.leader_name=l),name:"",label:"负责人:",placeholder:"负责人",readonly:""},null,8,["modelValue"]),r(u,{modelValue:a.value.leader_phone,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.leader_phone=l),name:"",label:"手机号:",placeholder:"手机号",readonly:""},null,8,["modelValue"])]),_:1}),r(k,{"label-align":"top"},{default:n(()=>[ce,r(u,{readonly:""},{input:n(()=>[p("div",ye,[(s(!0),F(G,null,H(a.value.materials,l=>(s(),F("div",null,_(l.name)+" "+_(l.number)+" "+_(l.unit),1))),256))])]),_:1}),fe,r(u,{readonly:"",modelValue:a.value.usage_location,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.usage_location=l),name:"",label:"地点:",placeholder:"请输入地点",rules:[{required:!0,message:"请输入地点"}]},null,8,["modelValue"]),r(u,{readonly:"",label:"时间:",placeholder:"请选择使用时间",rules:[{required:!0,message:"请选择使用时间"}]},{input:n(()=>[c(_(a.value.usage_start_time)+" 至 "+_(a.value.usage_end_time),1)]),_:1}),r(u,{readonly:"",autosize:"",type:"textarea",rows:"2",maxlength:"100",modelValue:a.value.usage_reason,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.usage_reason=l),name:"",label:"原因:",placeholder:"请输入使用原因",rules:[{required:!0,message:"请输入使用原因"}]},null,8,["modelValue"]),r(u,{readonly:"",name:"uploader",label:"上传图片:"},{input:n(()=>[r(R,{readonly:"",deletable:!1,modelValue:a.value.attachment,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.attachment=l),"after-read":T,multiple:"","max-count":3},null,8,["modelValue"])]),_:1}),r(u,{readonly:"",name:"uploader",label:"上传文件:"},{input:n(()=>{var l,w,x;return[p("a",{download:(l=a.value.file[0])==null?void 0:l.name,href:(w=a.value.file[0])==null?void 0:w.url},_((x=a.value.file[0])==null?void 0:x.name),9,ge)]}),_:1}),r(u,{readonly:"",modelValue:a.value.remark,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.remark=l),autosize:"",type:"textarea",maxlength:"144",label:"备注:",placeholder:"备注"},null,8,["modelValue"]),a.value.audit_status==2&&a.value.report_reason?(s(),d(u,{key:0,readonly:"",modelValue:a.value.report_reason,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.report_reason=l),label:"报备理由:",autosize:"",type:"textarea"},null,8,["modelValue"])):i("",!0),a.value.audit_status==2&&a.value.report_reason?(s(),d(u,{key:1,readonly:"",modelValue:a.value.report_amount,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.report_amount=l),label:"活动金额:"},null,8,["modelValue"])):i("",!0),a.value.audit_status==2&&a.value.report_reason?(s(),d(u,{key:2,readonly:"",name:"uploader",label:"报备图片:"},{input:n(()=>[r(R,{readonly:"",deletable:!1,modelValue:a.value.report_image,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.report_image=l),"after-read":T,multiple:"","max-count":3},null,8,["modelValue"])]),_:1})):i("",!0),a.value.audit_status==2&&a.value.report_reason?(s(),d(u,{key:3,readonly:"",name:"uploader",label:"报备文件:"},{input:n(()=>{var l,w,x;return[p("a",{download:(l=a.value.report_file[0])==null?void 0:l.name,href:(w=a.value.report_file[0])==null?void 0:w.url},_((x=a.value.report_file[0])==null?void 0:x.name),9,be)]}),_:1})):i("",!0),p("div",he,[q(h)==2&&a.value.audit_status==1?(s(),d(g,{key:0,type:"primary",onClick:e[10]||(e[10]=l=>C(1)),round:"",block:""},{default:n(()=>[c("撤销")]),_:1})):i("",!0),q(h)==1&&a.value.audit_status==1?(s(),d(g,{key:1,type:"primary",onClick:e[11]||(e[11]=l=>C(2)),round:"",block:""},{default:n(()=>[c("通过")]),_:1})):i("",!0),q(h)==1&&a.value.audit_status==1?(s(),d(g,{key:2,type:"primary",onClick:e[12]||(e[12]=l=>C(3)),round:"",block:""},{default:n(()=>[c("驳回")]),_:1})):i("",!0),q(h)==1&&a.value.audit_status==2&&a.value.reporter_phone&&!a.value.report_reason?(s(),d(g,{key:3,type:"primary",onClick:e[13]||(e[13]=l=>C(4)),round:"",block:""},{default:n(()=>[c("报备")]),_:1})):i("",!0),q(h)==2&&a.value.audit_status==2&&a.value.report_status==1&&a.value.report_reason?(s(),d(g,{key:4,type:"primary",onClick:I,round:"",block:""},{default:n(()=>[c("确认")]),_:1})):i("",!0)])]),_:1})]),r(j,{show:V.value,"onUpdate:show":e[19]||(e[19]=l=>V.value=l),round:"",position:"bottom",class:"dialog",closeable:"",style:Q({height:v.value.height})},{default:n(()=>[p("h4",null,_(v.value.label),1),r(k,{"label-align":"top",onSubmit:D},{default:n(()=>[v.value.status!=4?(s(),d(u,{key:0,required:"",modelValue:m.value.reason,"onUpdate:modelValue":e[14]||(e[14]=l=>m.value.reason=l),autosize:"",type:"textarea",rows:"3",maxlength:"144","show-word-limit":"",label:v.value.placeholder,placeholder:v.value.placeholder,rules:[{required:!0,message:"理由必须输入"}]},null,8,["modelValue","label","placeholder"])):i("",!0),v.value.status==4?(s(),d(u,{key:1,required:"",modelValue:m.value.report_reason,"onUpdate:modelValue":e[15]||(e[15]=l=>m.value.report_reason=l),autosize:"",type:"textarea",rows:"3",maxlength:"144","show-word-limit":"",label:"报备理由:",placeholder:"请输入报备理由",rules:[{required:!0,message:"请输入报备理由"}]},null,8,["modelValue"])):i("",!0),v.value.status==4?(s(),d(u,{key:2,required:"",modelValue:m.value.report_amount,"onUpdate:modelValue":e[16]||(e[16]=l=>m.value.report_amount=l),type:"number","show-word-limit":"",label:"报备金额:",placeholder:"请输入报备金额",rules:[{required:!0,message:"请输入报备金额"}]},null,8,["modelValue"])):i("",!0),v.value.status==4?(s(),d(u,{key:3,name:"uploader",label:"上传图片:",rules:[{message:"必须上传图片"}]},{input:n(()=>[r(R,{modelValue:m.value.report_image,"onUpdate:modelValue":e[17]||(e[17]=l=>m.value.report_image=l),"after-read":T,multiple:"","max-count":3},null,8,["modelValue"])]),_:1})):i("",!0),v.value.status==4?(s(),d(u,{key:4,name:"uploader",label:"报备附件:",rules:[{message:"只能上传PDF,TXT,XLS,DOC文件"}]},{input:n(()=>[r(R,{"max-count":1,modelValue:y.value,"onUpdate:modelValue":e[18]||(e[18]=l=>y.value=l),"after-read":A,"before-read":N,accept:"text/plain, application/vnd.ms-excel, application/vnd.ms-works, application/msword, application/pdf"},{default:n(()=>[r(g,{icon:"plus",style:{width:"100px"},size:"small",type:"primary"},{default:n(()=>[c("报备附件")]),_:1})]),_:1},8,["modelValue"])]),_:1})):i("",!0),r(g,{type:"primary",round:"",block:"","native-type":"submit"},{default:n(()=>[c("确定")]),_:1})]),_:1})]),_:1},8,["show","style"])])}}});const qe=ie(Ve,[["__scopeId","data-v-7ae6f9f5"]]);export{qe as default};
