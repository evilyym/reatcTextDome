<style lang="less" scoped>
.initiateApplication {
    /deep/.van-overlay {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    input {
        -webkit-appearance: none !important;
    }

    /deep/.van-picker__cancel {
        font-size: 32px;
        color: #999;
    }

    /deep/.van-picker__confirm {
        font-size: 32px;
        color: #61c5c1;
    }

    width: 100vw;

    .head_div {
        height: 200px;
        background: url(../assets/bg.png) no-repeat;
        background-size: 100%;
        display: flex;
        padding: 0 74px;
        align-items: center;
        position: relative;

        .img1 {
            position: absolute;
            top: 27px;
            right: 64px;
            z-index: 12;
            height: 230px;
        }

        .header_title {
            height: 50px;
        }

        .head_title_div {
            font-size: 40px;
            font-weight: bold;
            margin-bottom: 10px;

            .record {
                position: absolute;
                right: 0;
                top: 34px;
                width: 160px;
                height: 64px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 100px 0px 0px 100px;
                font-size: 28px;
                font-weight: bold;
                color: #ffffff;
                line-height: 64px;
                padding-right: 20px;
                text-align: right;
                z-index: 20;
            }
        }

        .head_inf_div {
            font-size: 32px;
            position: relative;
        }

        .head_link_div {
            font-size: 32px;
            text-decoration: underline;
        }
    }

    .inf_div {
        padding: 0 30px 150px 30px;
        box-shadow: 0px -8px 20px 0px rgba(0, 0, 0, 0.04);
        border-radius: 24px 24px 0px 0px;
        background: #ffffff;
        position: absolute;
        top: 176px;
        width: calc(100vw - 60px);
        overflow: hidden;
        z-index: 2;

        .inf_title_div {
            height: 116px;
            display: flex;
            align-items: center;
            font-size: 36px;
            font-weight: 600;
            color: #4487ed;
        }
    }

    .form_div {
        .form_item {
            position: relative;

            .code {
                position: absolute;
                font-size: 28px;
                font-weight: 600;
                right: 0;
                top: 40px;
            }

            .can_send {
                color: #4487ed;
            }

            .cannt {
                color: #cccccc;
            }

            &:last-child {
                border-bottom: 0px solid #eeeeee;
            }

            border-bottom: 1px solid #eeeeee;

            .form_title {
                display: flex;
                align-items: center;
                font-size: 28px;
                color: #666666;
                margin-top: 30px;

                span {
                    width: 16px;
                    color: #f46767;
                    margin-right: 12px;
                }
            }

            .form_select {
                .select {
                    width: 100%;
                    height: 86px;
                    font-size: 36px;
                    padding: 0 0 0 24px;
                    border: 0px solid #e6e6e6;
                    display: flex;
                    font-weight: 400;
                    align-items: center;
                    position: relative;
                }

                .icon-you {
                    position: absolute;
                    font-size: 36px;
                    color: #cccccc;
                    right: 30px;
                }

                .placeholder {
                    color: #ccc;
                }
            }

            .form_input {
                input {
                    width: 100%;
                    height: 86px;
                    font-size: 36px;
                    padding: 0 0 0 24px;
                    border: 0px solid #e6e6e6;
                }

                input::-webkit-input-placeholder {
                    /* WebKit browsers */
                    color: #ccc;
                }

                input:-moz-placeholder {
                    /* Mozilla Firefox 4 to 18 */
                    color: #ccc;
                }

                input::-moz-placeholder {
                    /* Mozilla Firefox 19+ */
                    color: #ccc;
                }

                input:-ms-input-placeholder {
                    /* Internet Explorer 10+ */
                    color: #ccc;
                }
            }

            .form_radio {
                display: flex;
                justify-content: space-between;
                width: 100%;
                height: 70px;
                font-size: 28px;
                color: #2a2a2a;

                .radio_item {
                    width: 310px;
                    height: 70px;
                    line-height: 70px;
                    background: #ffffff;
                    border-radius: 8px;
                    border: 1px solid #e6e6e6;
                    text-align: center;
                }

                .choise_radio {
                    color: #fff;
                    background: #61c5c1;
                }
            }

            /deep/.form_upImg {
                display: flex;

                .van-uploader__wrapper .van-uploader__preview:nth-child(3n) {
                    margin-right: 0px;
                }

                .van-uploader__preview {
                    width: 200px;
                    height: 200px;
                    margin-right: 20px;
                    margin-bottom: 0;

                    .van-image {
                        width: 200px;
                        height: 200px;
                        margin: 0;
                    }
                }

                .van-uploader__upload {
                    width: 200px;
                    height: 200px;
                    margin-bottom: 0;
                    margin-right: 0px;
                }
            }

            .tip {
                margin-top: 20px;
                padding: 0 24px;
                height: 48px;
                background: #fff7e5;
                border-radius: 28px;
                font-size: 24px;
                font-weight: bold;
                color: #875906;
                line-height: 48px;
            }
        }
    }

    .but_box {
        border-top: 1px solid #e6e6e6;
        background: #fff;
        position: fixed;
        bottom: 0;
        left: 0;
        padding: 24px;
        width: calc(100vw - 48px);

        .but_div {
            background: #4487ed;
            color: #ffffff;
            border-radius: 49px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            font-weight: bold;
            height: 98px;
        }
    }
}
</style>
<template>
    <div class="initiateApplication">
        <div class="head_div">
            <img src="../../assets/newImg/bg2.png" class="header_title" alt="">
            <img src="../../assets/newImg/1.png" class="img1" alt="">
        </div>
        <div class="inf_div">
            <div class="form_div">
                <div class="form_item" v-for="(item, index) of form1" :key="index">

                    <div v-if="item.type != 'title' && item.notShow != 1">
                        <div class="form_title">
                            <span v-if="item.required">*</span>
                            <span v-else></span>
                            <div>{{ item.name }}</div>
                        </div>
                        <div class="form_input" v-if="item.type == 'input'">
                            <input type="text" :maxlength="item.max" v-model="fromInf[item.prop]"
                                :placeholder='item.placeholder' />

                        </div>
                        <div class="form_select" v-if="item.type == 'select'">
                            <div class="select" @click="item.showPicker = true"
                                :class="[fromInf[item.prop] ? '' : 'placeholder']">
                                {{ fromInf[item.prop] ? item.show : item.placeholder }}
                                <i class="iconfont icon-you"></i>
                            </div>

                            <van-popup v-model="item.showPicker" round position="bottom">
                                <van-picker show-toolbar :columns="formList[item.list]" @cancel="item.showPicker = false"
                                    @confirm="(value) => {
                                        fromInf[item.prop] = value.id; item.show = value.text;
                                        item.showPicker = false
                                    }" />
                            </van-popup>

                        </div>
                        <div class="form_select" v-if="item.type == 'data'">
                            <div class="select" @click="item.showPicker = true"
                                :class="[fromInf[item.prop] ? '' : 'placeholder']">
                                {{ fromInf[item.prop] ? fromInf[item.prop] : item.placeholder }}
                                <i class="iconfont icon-you"></i>
                            </div>

                            <van-popup v-model="item.showPicker" round position="bottom">
                                <van-datetime-picker type="date" title="ÈÄâÊã©Âπ¥ÊúàÊó•" :min-date="item.minDate"
                                    :max-date="item.maxDate" show-toolbar @cancel="item.showPicker = false" @confirm="(value) => {
                                        fromInf[item.prop] = dateConvert('yyyy-MM-dd', value)
                                            ;
                                        item.showPicker = false
                                    }" />
                            </van-popup>

                        </div>
                        <div class="form_radio" v-if="item.type == 'radio'">
                            <div class="radio_item" :class="[fromInf[item.prop] == radioItem.id ? 'choise_radio' : '']"
                                v-for="(radioItem, radioIndex) of item.itemList" @click="fromInf[item.prop] = radioItem.id"
                                :key="radioIndex">
                                {{ radioItem.name }}
                            </div>
                        </div>

                        <div v-if="item.type == 'upImg'" class="">
                            <div class="form_upImg">
                                <van-uploader v-model="fromInf[item.prop]" :after-read="item.afterRead"
                                    :max-count="item.maxCount" />
                            </div>

                            <div class="tip" v-if="item.tip">
                                {{ item.tip }}</div>
                        </div>
                    </div>
                    <div v-if="item.type == 'title' && item.notShow != 1">
                        <div class="inf_title_div">
                            {{ item.title }}</div>
                    </div>
                    <div class="code" v-if="item.code == 1" :class="time == 0 ? 'can_send' : 'cannt'" @click="send">
                        {{ time == 0 ? 'Ëé∑ÂèñÈ™åËØÅÁ†Å' : `ÈáçÊñ∞ÂèëÈÄÅ(${time}s)` }}
                    </div>

                </div>
            </div>
            <div class="but_box">
                <div class="but_div" @click="submit">Êèê‰∫§ </div>
            </div>
        </div>
        <van-overlay :show="show" z-index='1000'>
            <van-loading color="#fff" vertical>Êèê‰∫§‰∏≠...
            </van-loading>
        </van-overlay>
    </div>
</template>

<script>
import httpApi from "../api/index.js"
import Vue from 'vue'
export default {
    data() {
        return {
            show: false,
            canSubmit: true,
            form: [
                {
                    type: 'title',
                    no_audit_show: 1,
                    title: 'ÂÆåÂñÑËÆøÂÆ¢‰ø°ÊÅØ'
                },
                {
                    type: 'input',
                    name: 'ËÆøÂÆ¢ÂßìÂêç',
                    required: true,
                    list: '',
                    placeholder: 'ËØ∑ËæìÂÖ•ËÆøÂÆ¢ÂßìÂêç',
                    no_audit_show: 1,
                    prop: 'name'
                },
                {
                    type: 'input',
                    name: 'ËÆøÂÆ¢Âçï‰Ωç',
                    required: true,
                    list: '',
                    placeholder: 'ËØ∑ËæìÂÖ•ÊÇ®ÊâÄÂ±ûÂçï‰ΩçÁöÑÂÆåÊï¥ÂêçÁß∞',
                    no_audit_show: 1,
                    prop: 'visitor_unit'
                },
                {
                    type: 'input',
                    name: 'ÊâãÊú∫Âè∑Á†Å',
                    required: true,
                    code: 1,
                    list: '',
                    placeholder: 'ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑Á†Å',
                    no_audit_show: 1,
                    prop: 'phone'
                },
                {
                    type: 'input',
                    name: 'Áü≠‰ø°È™åËØÅÁ†Å',
                    required: true,
                    list: '',
                    placeholder: 'ËØ∑ËæìÂÖ•Áü≠‰ø°È™åËØÅÁ†Å',
                    no_audit_show: 1,
                    prop: 'code',
                    max: 4
                },
                {
                    type: 'input',
                    name: 'Ë∫´‰ªΩËØÅÂè∑Á†Å',
                    required: true,
                    list: '',
                    placeholder: 'ËØ∑ËæìÂÖ•18‰ΩçË∫´‰ªΩËØÅÂè∑Á†Å',
                    prop: 'id_card',
                    no_audit_show: 1,
                    max: 18
                },
                {
                    type: 'data',
                    showPicker: false,
                    name: 'ÊãúËÆøÊó∂Èó¥',
                    required: true,
                    list: 'testList',
                    minDate: new Date(),
                    maxDate: new Date(2030, 10, 1),
                    placeholder: 'ËØ∑ÈÄâÊã©ÊãúËÆøÊó∂Èó¥',
                    no_audit_show: 1,
                    prop: 'visitor_at'
                },
                {
                    type: 'input',
                    name: 'ËΩ¶ÁâåÂè∑Á†Å',
                    required: false,
                    list: '',
                    placeholder: 'ËØ∑ËæìÂÖ•ËΩ¶ÁâåÂè∑Á†Å',
                    no_audit_show: 1,
                    prop: 'car_number'
                },
                // {
                //   type: 'title',
                //   title: 'Èò≤Áñ´‰ø°ÊÅØ'
                // },
                // {
                //   type: 'radio',
                //   name: 'ÊòØÂê¶‰∏∫È´òÂç±Âú∞Âå∫„ÄÅÂØÜÂàáÊé•Ëß¶ËÄÖ„ÄÅÁñë‰ººÂèäÁ°ÆËØäÁóÖ‰æã',
                //   required: true, placeholder: 'ËØ∑ÈÄâÊã©ÊòØÂê¶‰∏∫È´òÂç±Âú∞Âå∫„ÄÅÂØÜÂàáÊé•Ëß¶ËÄÖ„ÄÅÁñë‰ººÂèäÁ°ÆËØäÁóÖ‰æã',
                //   prop: 'health_status',
                //   itemList: [
                //     {
                //       name: 'Âê¶',
                //       id: '0'
                //     },
                //     {
                //       name: 'ÊòØ',
                //       id: '1'
                //     },
                //   ]
                // },
                // {
                //   type: 'upImg',
                //   name: 'ËØ∑‰∏ä‰º†Ë°åÁ®ãÂç°ÂõæÁâáÔºàÂèØ‰∏ä‰º†3Âº†Ôºâ',
                //   required: true,
                //   dataList: 'img_list2',
                //   prop: 'imgList',
                //   afterRead: async (file) => {
                //     file.status = 'uploading';
                //     file.message = '‰∏ä‰º†‰∏≠...';
                //     const files = new FormData()
                //     file.file = await this.$compressImg.compressImg(file.file)
                //     files.append("file", file.file)
                //     files.append("type", 0)
                //     httpApi.upload(files).then(res => {
                //       if (res.code == 200) {
                //         // this.fromInf.imgList.push(res.data.url)
                //         file.url = res.data.url
                //         file.status = 'done';
                //       }
                //     })
                //   },
                //   maxCount: '3',
                // },
                // {
                //   type: 'upImg',
                //   name: 'ËØ∑‰∏ä‰º†ÂÅ•Â∫∑Á†ÅÂõæÁâáÔºàÂèØ‰∏ä‰º†3Âº†Ôºâ',
                //   required: true,
                //   dataList: 'img_list2_1',
                //   prop: 'imgList2',
                //   afterRead: async (file) => {
                //     file.status = 'uploading';
                //     file.message = '‰∏ä‰º†‰∏≠...';
                //     const files = new FormData()
                //     file.file = await this.$compressImg.compressImg(file.file)
                //     files.append("file", file.file)
                //     files.append("type", 0)
                //     httpApi.upload(files).then(res => {
                //       if (res.code == 200) {
                //         file.url = res.data.url
                //         file.status = 'done';
                //       }
                //     })
                //   },
                //   maxCount: '3',
                // },
                // {
                //   type: 'upImg',
                //   tip: 'Ê≥®:ËØ∑Êèê‰æõ7Â§©ÂÜÖÊ†∏ÈÖ∏Èò¥ÊÄßËØÅÊòé!',
                //   name: 'ËØ∑‰∏ä‰º†Ê†∏ÈÖ∏Êä•ÂëäÂõæÁâáÔºàÂèØ‰∏ä‰º†3Âº†Ôºâ',
                //   required: true,
                //   dataList: 'img_list2_2',
                //   prop: 'imgList3',
                //   afterRead: async (file) => {
                //     file.status = 'uploading';
                //     file.message = '‰∏ä‰º†‰∏≠...';
                //     const files = new FormData()
                //     file.file = await this.$compressImg.compressImg(file.file)
                //     files.append("file", file.file)
                //     files.append("type", 0)
                //     httpApi.upload(files).then(res => {
                //       if (res.code == 200) {
                //         file.url = res.data.url
                //         file.status = 'done';
                //       }
                //     })
                //   },
                //   maxCount: '3',
                // },
                {
                    type: 'title',
                    no_audit_show: 1,
                    title: 'ÊãúËÆø‰ø°ÊÅØ'
                },
                {
                    type: 'select',
                    showPicker: false,
                    name: 'ÊãúËÆøÂú∞ÁÇπ',
                    required: true,
                    list: 'depList',
                    no_audit_show: 1,
                    placeholder: 'ËØ∑ÈÄâÊã©ÊãúËÆøÂú∞ÁÇπ',
                    prop: 'dep_id',
                    show: ''
                },
                {
                    type: 'input',
                    name: 'Ë¢´ËÆø‰∫∫ÂßìÂêç',
                    required: true,
                    list: '',
                    no_audit_show: 1,
                    placeholder: 'ËØ∑ËæìÂÖ•Ë¢´ËÆø‰∫∫ÂßìÂêç',
                    prop: 'visited_name'
                },
                {
                    type: 'input',
                    name: 'Ë¢´ËÆø‰∫∫ÊâãÊú∫Âè∑Á†Å',
                    required: false,
                    list: '',
                    no_audit_show: 1,
                    placeholder: 'ËØ∑ËæìÂÖ•Ë¢´ËÆø‰∫∫ÊâãÊú∫Âè∑Á†Å',
                    prop: 'visited_phone'
                },
                {
                    type: 'select',
                    showPicker: false,
                    name: 'ÂÖ•Âõ≠‰∫ãÁî±',
                    required: true,
                    list: 'subjectList',
                    no_audit_show: 1,
                    placeholder: 'ËØ∑ÈÄâÊã©ÂÖ•Âõ≠‰∫ãÁî±',
                    prop: 'subject_id',
                    show: ''
                },
                {
                    type: 'input',
                    name: 'Â§áÊ≥®',
                    required: true,
                    max: 80,
                    list: '',
                    notShow: 1,
                    no_audit_show: 1,
                    placeholder: 'ËØ∑ËæìÂÖ•Â§áÊ≥®',
                    prop: 'remarks'
                },
                {
                    type: 'title',
                    no_audit_show: 1,
                    title: 'ÂÅ•Â∫∑‰ø°ÊÅØ'
                },
                {
                    type: 'select',
                    showPicker: false,
                    name: 'ÁõÆÂâçÂÅ•Â∫∑Áä∂ÂÜµ',
                    required: true,
                    list: 'healthList',
                    no_audit_show: 1,
                    placeholder: 'ËØ∑ÈÄâÊã©ÁõÆÂâçÂÅ•Â∫∑Áä∂ÂÜµ',
                    prop: 'health',
                    show: ''
                },
                {
                    type: 'input',
                    name: 'Â§áÊ≥®',
                    required: true,
                    list: '',
                    notShow: 1,
                    no_audit_show: 1,
                    placeholder: 'ËØ∑ËæìÂÖ•Â§áÊ≥®',
                    prop: 'health_remarks'
                },
            ],
            time: 0,
            fromInf: {
                code: '',
                health: '',
                health_remarks: '',
                name: '',
                visitor_unit: '',
                phone: '',
                id_card: '',
                visitor_at: '',
                car_number: '',
                health_status: '',
                dep_id: '',
                visited_name: '',
                visited_phone: '',
                subject_id: '',
                remarks: '',
                // img_list: '',
                health_code: '',
                // report_img: '',
                imgList: [],
                imgList2: [],
                // imgList3: [],
            },
            formList: {
                subjectList: [],
                depList: [],
                healthList: [
                    { text: 'ÂÅ•Â∫∑', id: 'ÂÅ•Â∫∑' },
                    { text: 'ÊúâÂèëÁÉßÔºåÂí≥ÂóΩÔºå‰πèÂäõÁ≠âÁóáÁä∂', id: 'ÊúâÂèëÁÉßÔºåÂí≥ÂóΩÔºå‰πèÂäõÁ≠âÁóáÁä∂' },
                    { text: 'ÂÖ∂ÂÆÉ', id: 'ÂÖ∂ÂÆÉ' },
                ]
            },

        }
    },
    watch: {
        // 'fromInf.visited_phone': function (val) {
        //   if (val.length == 11) {
        //     const myreg = /^[1][3,4,5,7,8,9][0-9]{9}$/;
        //     if (!myreg.test(val)) {
        //       this.$toast("ÊâãÊú∫Âè∑Ê†ºÂºèÈîôËØØÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•")
        //     }
        //   }
        // },
        // 'fromInf.phone': function (val) {
        //   if (val.length == 11) {
        //     const myreg = /^[1][3,4,5,7,8,9][0-9]{9}$/;
        //     if (!myreg.test(val)) {
        //       this.$toast("ÊâãÊú∫Âè∑Ê†ºÂºèÈîôËØØÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•")
        //     }
        //   }
        // },
        // 'fromInf.id_card': function (val) {
        //   if (val.length == 18) {
        //     if (!this.isIdCard(val)) {
        //       this.$toast("Ë∫´‰ªΩËØÅÊ†ºÂºèÈîôËØØÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•")
        //     }
        //   }
        // },
        'fromInf.subject_id': function (val) {
            console.log(val)
            for (let i of this.formList.subjectList) {
                if (i.id == val) {// prop: 'remarks'
                    console.log(i.content, i.content == 'ÂÖ∂ÂÆÉ', 'i.content')
                    if (i.content == 'ÂÖ∂ÂÆÉ' || i.content == 'ÂÖ∂‰ªñ') {
                        console.log(123)
                        for (let j in this.form) {

                            if (this.form[j].prop == 'remarks') {
                                this.form[j].notShow = 0
                            }
                        }
                    } else {
                        for (let j in this.form) {
                            if (this.form[j].prop == 'remarks') {

                                this.form[j].notShow = 1
                            }
                        }
                    }
                }
            }

        },
        'fromInf.health': function (val) {
            console.log(val, this.formList.healthList)
            for (let i of this.formList.healthList) {
                if (i.id == val) {// prop: 'remarks'
                    console.log(i.content, i.content == 'ÂÖ∂ÂÆÉ', 'i.content')
                    if (i.text == 'ÂÖ∂ÂÆÉ' || i.text == 'ÂÖ∂‰ªñ') {
                        console.log(123)
                        for (let j in this.form) {

                            if (this.form[j].prop == 'health_remarks') {
                                this.form[j].notShow = 0
                            }
                        }
                    } else {
                        for (let j in this.form) {
                            if (this.form[j].prop == 'health_remarks') {

                                this.form[j].notShow = 1
                            }
                        }
                    }
                }
            }

        },
    },
    computed: {
        form1() {
            return this.form.filter(i => { return i.no_audit_show == 1 && i.notShow != 1 })
        }
    },
    methods: {
        async send() {
            if (this.time == 0) {
                if (!this.fromInf.phone) {
                    this.$toast("ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑")
                    return
                } else if (this.fromInf.phone.length != 11) {
                    this.$toast("ÊâãÊú∫Âè∑Ê†ºÂºèÈîôËØØÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•")
                    return
                } else {
                    const myreg = /^[1][3,4,5,7,8,9][0-9]{9}$/;
                    if (!myreg.test(this.fromInf.phone)) {
                        this.$toast("ÊâãÊú∫Âè∑Ê†ºÂºèÈîôËØØÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•")
                        return
                    }
                }
                const { code, data } = await httpApi.sendCode({ mobile: this.fromInf.phone })
                if (code == 200) {
                    this.time = 60
                    this.setTime()
                }

            }
        },
        setTime() {
            if (this.time > 0) {
                this.time = this.time - 1
                setTimeout(() => {
                    this.setTime()
                }, 1000);
            }
        },
        goRecord() {
            this.$router.push({
                path: '/record',
                query: {
                    back: this.$route.query.back ? this.$route.query.back : 0,
                    record_type: 2
                }
            })
        },
        isIdCard(idCard) {
            // 15‰ΩçÂíå18‰ΩçË∫´‰ªΩËØÅÂè∑Á†ÅÁöÑÊ≠£ÂàôË°®ËææÂºè
            var regIdCard = /^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/;
            // Â¶ÇÊûúÈÄöËøáËØ•È™åËØÅÔºåËØ¥ÊòéË∫´‰ªΩËØÅÊ†ºÂºèÊ≠£Á°ÆÔºå‰ΩÜÂáÜÁ°ÆÊÄßËøòÈúÄËÆ°ÁÆó
            if (regIdCard.test(idCard)) {
                if (idCard.length == 18) {
                    var idCardWi = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10,
                        5, 8, 4, 2); // Â∞ÜÂâç17‰ΩçÂä†ÊùÉÂõ†Â≠ê‰øùÂ≠òÂú®Êï∞ÁªÑÈáå
                    var idCardY = new Array(1, 0, 10, 9, 8, 7, 6, 5, 4, 3, 2); // ËøôÊòØÈô§‰ª•11ÂêéÔºåÂèØËÉΩ‰∫ßÁîüÁöÑ11‰Ωç‰ΩôÊï∞„ÄÅÈ™åËØÅÁ†ÅÔºå‰πü‰øùÂ≠òÊàêÊï∞ÁªÑ
                    var idCardWiSum = 0; // Áî®Êù•‰øùÂ≠òÂâç17‰ΩçÂêÑËá™‰πñ‰ª•Âä†ÊùÉÂõ†Â≠êÂêéÁöÑÊÄªÂíå
                    for (var i = 0; i < 17; i++) {
                        idCardWiSum += idCard.substring(i, i + 1) * idCardWi[i];
                    }

                    var idCardMod = idCardWiSum % 11;// ËÆ°ÁÆóÂá∫Ê†°È™åÁ†ÅÊâÄÂú®Êï∞ÁªÑÁöÑ‰ΩçÁΩÆ
                    var idCardLast = idCard.substring(17);// ÂæóÂà∞ÊúÄÂêé‰∏Ä‰ΩçË∫´‰ªΩËØÅÂè∑Á†Å

                    // Â¶ÇÊûúÁ≠â‰∫é2ÔºåÂàôËØ¥ÊòéÊ†°È™åÁ†ÅÊòØ10ÔºåË∫´‰ªΩËØÅÂè∑Á†ÅÊúÄÂêé‰∏Ä‰ΩçÂ∫îËØ•ÊòØX
                    if (idCardMod == 2) {
                        if (idCardLast == "X" || idCardLast == "x") {
                            //alert("ÊÅ≠ÂñúÈÄöËøáÈ™åËØÅÂï¶ÔºÅ");
                            return true;
                        } else {
                            //alert("Ë∫´‰ªΩËØÅÂè∑Á†ÅÈîôËØØÔºÅ");
                            return false;
                        }
                    } else {
                        // Áî®ËÆ°ÁÆóÂá∫ÁöÑÈ™åËØÅÁ†Å‰∏éÊúÄÂêé‰∏Ä‰ΩçË∫´‰ªΩËØÅÂè∑Á†ÅÂåπÈÖçÔºåÂ¶ÇÊûú‰∏ÄËá¥ÔºåËØ¥ÊòéÈÄöËøáÔºåÂê¶ÂàôÊòØÊó†ÊïàÁöÑË∫´‰ªΩËØÅÂè∑Á†Å
                        if (idCardLast == idCardY[idCardMod]) {
                            //alert("ÊÅ≠ÂñúÈÄöËøáÈ™åËØÅÂï¶ÔºÅ");
                            return true;
                        } else {
                            //alert("Ë∫´‰ªΩËØÅÂè∑Á†ÅÈîôËØØÔºÅ");
                            return false;
                        }
                    }
                } else {
                    return true;
                }
            } else {
                //alert("Ë∫´‰ªΩËØÅÊ†ºÂºè‰∏çÊ≠£Á°Æ!");
                return false;
            }
        },
        dateConvert(format, value) {
            var date = value
            var o = {
                "M+": date.getMonth() + 1,     //Êúà‰ªΩ
                "d+": date.getDate(),     //Êó•
                "h+": date.getHours(),     //Â∞èÊó∂
                "m+": date.getMinutes(),     //ÂàÜ
                "s+": date.getSeconds(),     //Áßí
                "q+": Math.floor((date.getMonth() + 3) / 3), //Â≠£Â∫¶
                "S": date.getMilliseconds()    //ÊØ´Áßí
            };
            if (/(y+)/.test(format))
                format = format.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(format))
                    format = format.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return format;
        },
        async getListData() {
            let url = decodeURI(location.href)

            // if (url.indexOf('dep_id') > -1 ) let dep_id = url.split('dep_id=')[1].split('&')[0]


            await httpApi.getDep({ type: 2 }).then(res => {
                if (res.code == 200 && res.data) {
                    for (let i of res.data) {
                        i.text = i.name
                    }
                    this.formList.depList = res.data
                }
            })
            await httpApi.getSubject({}).then(res => {
                if (res.code == 200 && res.data) {
                    for (let i of res.data) {
                        i.text = i.content
                    }
                    this.formList.subjectList = res.data
                }
            })

            console.log("üöÄ ~ file: index.vue:1019 ~ mounted ~ url:", url)
            if (url.indexOf('dep_id') > -1) {
                let dep_id = url.split('dep_id=')[1].split('&')[0], name = ''
                this.fromInf.dep_id = dep_id
                this.formList.depList.map(i => {
                    if (i.id == dep_id) {
                        name = i.name
                    }
                })
                this.fromInf.visitor_at = this.getNowTimeFull()
                this.form.map(i => {
                    if (i.prop == 'dep_id' || i.prop == 'visitor_at') {
                        i.show = name
                        i.notShow = 1
                    }
                    return i
                })


            }
            if (url.indexOf('name') > -1 && (sessionStorage.getItem('tenantCode') == 'S10101' || sessionStorage.getItem('tenantCode') == 'S10109')) {
                let name = url.split('name=')[1].split('&')[0]
                let bjArr = ['lide', 'liye', 'lizhi']
                if (bjArr.indexOf(name) > -1) {
                    if (name == 'lide') {
                        name = 'Á´ãÂæ∑Âõ≠'
                    } else if (name == 'liye') {
                        name = 'Á´ã‰∏öÂõ≠'
                    } else if (name == 'lizhi') {
                        name = 'Á´ãÂøóÂõ≠'
                    }
                    this.formList.depList.map(i => {
                        if (i.name == name) {
                            this.fromInf.dep_id = i.id
                        }
                    })
                    this.fromInf.visitor_at = this.getNowTimeFull()
                    console.log("üöÄ ~ file: index.vue:818 ~ getListData ~ this.fromInf.visitor_at:", this.fromInf.visitor_at)
                    this.form.map(i => {
                        if (i.prop == 'dep_id' || i.prop == 'visitor_at') {
                            i.show = name
                            i.notShow = 1
                        }
                        return i
                    })
                    console.log("üöÄ ~ file: index.vue:1021 ~ mounted ~ name:", name)
                    console.log(name, 12321312312)
                }

            }

            if (this.$route.query.item) {
                this.setData()
            }
        },
        getNowTimeFull() {
            var myDate = new Date;
            var year = myDate.getFullYear(); //Ëé∑ÂèñÂΩìÂâçÂπ¥
            var mon = myDate.getMonth() + 1 < 10 ? "0" + (myDate.getMonth() + 1) : myDate.getMonth() + 1; //Ëé∑ÂèñÂΩìÂâçÊúà
            var date = myDate.getDate() < 10 ? "0" + myDate.getDate() : myDate.getDate(); //Ëé∑ÂèñÂΩìÂâçÊó•
            return year + "-" + mon + "-" + date
        },
        submit() {
            console.log(this.fromInf)
            for (let i in this.fromInf) {
                if (i.indexOf('img') == -1 && !this.fromInf[i]) {
                    for (let j of this.form) {
                        if (j.prop == i && j.required && !j.notShow && j.no_audit_show == 1) {
                            this.$toast(j.placeholder)
                            return false
                        }
                    }
                }
            }

            // let imgsList = []
            // for (let i of this.fromInf.imgList) {
            //   imgsList.push(i.url)
            // }
            let imgsList2 = []
            // for (let i of this.fromInf.imgList2) {
            //   imgsList2.push(i.url)
            // }
            // let imgsList3 = []
            // for (let i of this.fromInf.imgList3) {
            //   imgsList3.push(i.url)
            // }
            // this.fromInf.img_list = JSON.stringify(imgsList)
            // this.fromInf.health_code = JSON.stringify(imgsList2)
            // this.fromInf.report_img = JSON.stringify(imgsList3)
            // console.log(this.fromInf.imgList, this.fromInf.img_list)
            // if (!imgsList[0]) {
            //   this.$toast('ËØ∑‰∏ä‰º†Ë°åÁ®ãÂç°ÂõæÁâá');
            //   return
            // }
            // if (!imgsList2[0]) {
            //   this.$toast('ËØ∑‰∏ä‰º†ÂÅ•Â∫∑Á†ÅÂõæÁâá');
            //   return
            // }
            // if (!imgsList3[0]) {
            //   this.$toast('ËØ∑‰∏ä‰º†Ê†∏ÈÖ∏Êä•ÂëäÂõæÁâá');
            //   return
            // }


            // const myreg = /^[1][3,4,5,7,8,9][0-9]{9}$/;
            // if (!myreg.test(this.fromInf.phone)) {
            //   this.$toast("ÊâãÊú∫Âè∑Ê†ºÂºèÈîôËØØÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•")
            //   return false
            // }
            // if (this.fromInf.visited_phone && !myreg.test(this.fromInf.visited_phone)) {
            //   this.$toast("Ë¢´ÊãúËÆø‰∫∫ÊâãÊú∫Âè∑Ê†ºÂºèÈîôËØØÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•")
            //   return false
            // }



            // if (!this.isIdCard(this.fromInf.id_card)) {
            //   this.$toast("Ë∫´‰ªΩËØÅÊ†ºÂºèÈîôËØØÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•")
            //   return false
            // }

            this.show = true

            let data = JSON.parse(JSON.stringify(this.fromInf))
            if (!this.canSubmit) {
                return false
            }
            this.canSubmit = false
            delete data.imgList
            delete data.imgList2
            // delete data.imgList3
            httpApi.addAudit(data).then(res => {
                console.log("üöÄ ~ file: index.vue:776 ~ httpApi.addAudit ~ res", res)
                this.canSubmit = true
                this.show = false
                if (res.code == 200) {
                    this.$toast(res.msg)
                    setTimeout(() => {
                        this.$router.push(
                            {
                                name: 'applicationResults'
                            }
                        )
                    }, 1000);
                } else {
                    // this.$toast(res.msg)
                    this.$dialog({
                        message:
                            ` <i class="iconfont icon-guanbi"></i>
            <div class='text-dialog'>${res.msg}</div>`,
                        showConfirmButton: false,
                        closeOnClickOverlay: true,
                        width: 200
                    })
                }
            }).catch(err => {
                this.canSubmit = true
                this.show = false
                this.$toast('ÊúçÂä°Âô®ÈîôËØØÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÊàñËÄÖËØ∑Á®çÂêéÂÜçËØïÔºÅ')
            })
        },
        getJsapi() {
            let data = {
                callUrl: location.href.split('#')[0],
            }
            httpApi.sdk(data).then(res => {
                if (res.code == 200) {
                    console.log(res)
                    this.wx.config({
                        debug: location.href.indexOf('debug') == -1 ? false : true, // ÂºÄÂêØË∞ÉËØïÊ®°Âºè,Ë∞ÉÁî®ÁöÑÊâÄÊúâapiÁöÑËøîÂõûÂÄº‰ºöÂú®ÂÆ¢Êà∑Á´ØalertÂá∫Êù•ÔºåËã•Ë¶ÅÊü•Áúã‰º†ÂÖ•ÁöÑÂèÇÊï∞ÔºåÂèØ‰ª•Âú®pcÁ´ØÊâìÂºÄÔºåÂèÇÊï∞‰ø°ÊÅØ‰ºöÈÄöËøálogÊâìÂá∫Ôºå‰ªÖÂú®pcÁ´ØÊó∂Êâç‰ºöÊâìÂç∞„ÄÇ
                        appId: String(res.data.appId), // ÂøÖÂ°´ÔºåÂÖ¨‰ºóÂè∑ÁöÑÂîØ‰∏ÄÊ†áËØÜ
                        timestamp: String(res.data.timestamp), // ÂøÖÂ°´ÔºåÁîüÊàêÁ≠æÂêçÁöÑÊó∂Èó¥Êà≥
                        nonceStr: String(res.data.nonceStr), // ÂøÖÂ°´ÔºåÁîüÊàêÁ≠æÂêçÁöÑÈöèÊú∫‰∏≤
                        signature: String(res.data.signature), // ÂøÖÂ°´ÔºåÁ≠æÂêç
                        jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage'], // ÂøÖÂ°´ÔºåÈúÄË¶Å‰ΩøÁî®ÁöÑJSÊé•Âè£ÂàóË°®
                        openTagList: ['wx-open-launch-weapp']
                    })
                }
            })
        },
        record() {
            httpApi.record({}).then(res => {
                if (res.code == 200 && res.data.status == 2 && this.$route.query.back != 1) {
                    location.replace('/res')
                }
            })

        },
        setData() {
            let data = JSON.parse(this.$route.query.item)
            console.log("üöÄ ~ file: index.vue ~ line 834 ~ setData ~ data", data)
            //ÂåÖÂê´ËÆøÂÆ¢ÂßìÂêç„ÄÅËÆøÂÆ¢Âçï‰Ωç„ÄÅÊâãÊú∫Âè∑Á†Å„ÄÅË∫´‰ªΩËØÅÂè∑Á†Å„ÄÅÊãúËÆøÊó∂Èó¥‰∏∫ÂΩìÂ§©Êó∂Èó¥„ÄÅËΩ¶ÁâåÂè∑Á†Å‰πüÂºïÁî®‰∏äÊ¨°ËÆ∞ÂΩï
            this.fromInf.name = data.name
            this.fromInf.car_number = data.car_number
            this.fromInf.phone = data.phone
            this.fromInf.id_card = data.id_card
            this.fromInf.visitor_unit = data.visitor_unit
            this.fromInf.visited_phone = data.visited_phone
            this.fromInf.visited_name = data.visited_name
            this.fromInf.dep_id = data.dep_id
            for (let i of this.form) {

                if (i.name == "ÊãúËÆøÂú∞ÁÇπ") {
                    for (let j of this.formList.depList) {
                        if (j.id == data.dep_id) {
                            i.show = j.text
                        }
                    }
                }
            }

            // this.fromInf.subject_id = data.subject_id
            // this.fromInf.remarks = data.remarks

        },
        async fieleList() {
            const healthTitle = (val) => {
                this.form.map(i => {
                    if (i.title == 'ÂÅ•Â∫∑‰ø°ÊÅØ') {
                        i.no_audit_show = val
                    }
                })
            }
            const { code, data } = await httpApi.fieleList({})
            console.log("üöÄ ~ file: index.vue:963 ~ fieleList ~ code, data:", code, data)
            if (code == 200) {
                for (let i of this.form) {
                    for (let j of data) {
                        if (i.prop == j.field_sub_name) {
                            i.required = j.no_audit_status == 1 ? true : false
                            i.no_audit_show = j.no_audit_show
                            if (i.prop == 'health') {
                                healthTitle(i.no_audit_show)
                            }
                        }
                    }
                }


            }

        }
    },
    // beforeRouteEnter (to, from, next) {
    //   let u = navigator.userAgent
    //   let isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/) //iosÁªàÁ´Ø
    //   //XXX: ‰øÆÂ§çiOSÁâàÂæÆ‰ø°HTML5 HistoryÂÖºÂÆπÊÄßÈóÆÈ¢ò
    //   if (isiOS) {
    //     if (to.path !== location.pathname) {
    //       location.assign(to.fullPath)

    //     } else {
    //       if (sessionStorage.getItem('isIosEnter')) {
    //         next()
    //       } else {
    //         sessionStorage.setItem('isIosEnter', true)
    //         location.assign(to.fullPath)
    //       }

    //     }
    //     // Ê≠§Â§Ñ‰∏çÂèØ‰ΩøÁî®location.replace
    //   } else {
    //     next()
    //   }
    // },
    mounted() {
        // this.record()
        this.fieleList()
        Vue.config.ignoredElements = ['wx-open-launch-weapp']
        this.getJsapi()
        this.getListData()
    }

}
</script>